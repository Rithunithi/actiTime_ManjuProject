(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[17],{1056:function(y,D,b){b.d(D,"a",function(){return a});y=b(0);var a;(function(d){d[d.unknown=0]="unknown";d[d.supported=1]="supported";d[d.userUnsupportedAnonymous=2]="userUnsupportedAnonymous";d[d.userUnsupportedNoLoginHint=3]="userUnsupportedNoLoginHint";d[d.hostUnsupported=4]="hostUnsupported"})(a||(a={}));Object(y.b)("SupportStatus",a)},1402:function(y,D,b){function a(W){var R=ia.call(this)||this;R.$=W;R.dc();return R}
function d(W){this.oAuthManager=W}function c(){}function k(W){this.WSb=W}function n(){}function l(){}b.r(D);y=b(0);var f=b(13),u=b(985),v=b(1056),m=b(5),A=b(93),x=b(857),t=b(274),z=b(47),r=b(23),G=b(86),w=b(178);l.prototype.di=function(W){W.register(685,"Common.App.OAuth.IOAuthManager").zc().Ic(function(){return new u.OAuthManager})};l.prototype.init=function(){var W=G.a.instance.resolve("Common.App.OAuth.IOAuthManager");this.dGj(W)};l.prototype.dGj=function(W){var R=m.AFrameworkApplication.ga.Ua("FileSource");
if(m.AFrameworkApplication.ga.ra("IsO365ConsumerHost")||m.AFrameworkApplication.ga.ra("IsO365CommercialHost")||"WopiTest"===R){var I=x.a.bzh,Q=x.a.authority;if(void 0!==I&&null!==I&&I.length&&void 0!==Q&&null!==Q&&Q.length){var O=v.a[W.hS],ba=r.a.TFa,ca=W.Cu();try{var S=new Map;void 0!==S&&null!==S?(S.set("SupportStatus",O),S.set("Browser",ba),S.set("AuthStrategy",ca)):S=null}catch(ma){S=null}A.Health.instance.recordKpiUsageForAlertableKpi("WacCorePFT","WacOAuthFC",S);var Y=z.a.me();W.XR("Core",I).then(function(ma){var Z=
Math.floor(z.a.me()-Y);O=v.a[W.hS];ba=r.a.TFa;ca=W.Cu();f.ULS.sendTraceTag(562943369,3E3,50,'OAuthManager attempted to get a Core token to the WAC FrontEnd API in {0} ms. Success={1}, SupportStatus={2}, ErrorCode="{3}", Host="{4}", Browser="{5}", AuthStrategy="{6}"',Z,ma.IsSuccess,O,ma.ErrorCode,R,ba,ca);S&&(S.set("SupportStatus",O),S.set("Browser",ba),S.set("AuthStrategy",ca));Z=Object.assign(new w.a,{durationMs:Z,extendedProperties:S});ma.IsSuccess?A.Health.instance.recordKpiSuccess("WacCorePFT",
Z):A.Health.instance.recordKpiFailure("WacCorePFT",ma.ErrorCode,!1,!1,Z)})}}};l.prototype.dispose=function(){};l.main=function(){t.a.instance.mj(new l)};tl.Object.defineProperties(l.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.OAuth.OAuthPackage"}}});Object(y.a)(l,"OAuthPackage",null,[4,5]);var B=b(1083);Object(y.a)(n,"LokiTokenResult",null,[]);k.prototype.ydd=function(){var W=this,R=this.XLh();return R?k.jnd?new Promise(function(I,Q){W.WSb.continueWith(function(){W.WSb.Ch||
W.WSb.jg?Q(Error.create("Error downloading auth library")):W.WSb.result.XR("Loki",R).then(function(O){O=m.AFrameworkApplication.ga.ra("ForceLokiFallbackToACLPTokenIsEnabled")?W.$Lh():O.IsSuccess&&O.Token?Object.assign(new n,{isSuccess:!0,token:O.Token,errorMessage:null}):Object.assign(new n,{isSuccess:!1,token:null,errorMessage:JSON.stringify(O)});I(O);return O})})}):Promise.resolve(Object.assign(new n,{isSuccess:!1,token:null,errorMessage:"Not attempting to fetch token because host is not an O365 host."})):
Promise.resolve(Object.assign(new n,{isSuccess:!1,token:null,errorMessage:String.format("Could not get Loki App Id for HostAuthorityType: [{0}]",B.a.cUe())}))};k.prototype.$Lh=function(){var W=m.AFrameworkApplication.ga.Ua("LokiUserDataSignature")||"";return Object.assign(new n,{isSuccess:!0,token:W,errorMessage:null})};k.prototype.XLh=function(){var W=null,R=B.a.w9b();2===R?W=m.AFrameworkApplication.ga.Ua("LokiAADAppId"):1===R&&(W=m.AFrameworkApplication.ga.Ua("LokiMSAAppId"));return W};tl.Object.defineProperties(k,
{jnd:{configurable:!0,enumerable:!0,get:function(){return m.AFrameworkApplication.ga.ra("IsO365CommercialHost")||m.AFrameworkApplication.ga.ra("IsO365ConsumerHost")}}});Object(y.a)(k,"LokiTokenManager",null,[699]);var U=b(524);c.prototype.init=function(){G.a.instance.resolve("Common.ILokiTokenManager")};c.prototype.dispose=function(){};c.prototype.di=function(W){W.register(k,"Common.App.LivePersonaUtils.LokiTokenManager").as("Common.ILokiTokenManager").zc().Ic(function(){return new k(U.a.Fq(W.mc("Common.App.OAuth.IOAuthManager")))})};
c.main=function(){t.a.instance.mj(new c)};tl.Object.defineProperties(c.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.LivePersonaUtils"}}});Object(y.a)(c,"LivePersonaUtilsPackage",null,[4,5]);var N=b(10);D=b(216);var P=b(947);d.prototype.XR=function(W,R){return this.oAuthManager?this.oAuthManager.XR(W,R).then(function(I){I.IsSuccess||f.ULS.sendTraceTag(51401292,0,15,"Error retrieving auth token. Message: "+I.ErrorMessage+" Error code: "+I.ErrorCode+" App name: "+W);
return Object.assign(new P.a,{IsSuccess:I.IsSuccess,Token:I.Token,ErrorCode:I.ErrorCode,ErrorMessage:I.ErrorMessage})}):(f.ULS.sendTraceTag(537154971,0,10,"Oauth manager is null"),Promise.resolve(Object.assign(new P.a,{IsSuccess:!1,Token:null,ErrorCode:"FailedToResolve",ErrorMessage:"Failed to resolve IOAuthManager from the container."})))};d.prototype.gLa=function(){return this.oAuthManager?this.oAuthManager.gLa():null};Object(y.a)(d,"OAuthManagerWrapper",null,[698]);var ia=D.a;vm(a,ia);a.prototype.create=
function(){this.Fb(this.$.da.Aa(349)||new d(G.a.instance.resolve("Common.App.OAuth.IOAuthManager")))};a.ja=function(W){W.da.Ha(350,new a(W))};Object(y.a)(a,"OAuthManagerFactory",D.a,[]);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.AppsForOfficeCommon");Type.registerNamespace("Common.App.OAuth");l.main();Type.registerNamespace("Common.App.LivePersonaUtils");c.main();(function(){N.a.Ga(function(W){a.ja(W)})})()},985:function(y,D,b){function a(pa){var Ia=this;pa=void 0===pa?null:
pa;this.hS=0;this.vO=null;this.jqg=0;var Ma=ma.a.me();this.Qlg=this.u$g(pa).then(function(lb){return lb?Ia.B2h():(t.ULS.sendTraceTag(527827277,3E3,15,"DetermineAuthLibrary failed leaving {0} in {1} ms, all future TryGetToken requests will fail.",Ia.Cu(),Math.floor(ma.a.me()-Ma)),lb=Ia.kq(),void 0!==lb&&null!==lb&&(lb.set("AuthLibrary",Ia.Cu()),lb=Object.assign(new xa.a,{durationMs:Math.floor(ma.a.me()-Ma),extendedProperties:lb}),Y.Health.instance.recordKpiFailure(a.kpiName,"StrategyPickFailed",!1,
!0,lb)),Promise.resolve(1))}).then(function(lb){return lb?Promise.resolve(lb):Ia.Tki()})}function d(pa){this.yNc=pa;this.BWa="UnsupportedAuthTokenStrategy Reason="+r.a[this.yNc]}function c(){this.ls=null;this.oRb=0;this.Gib=this.OWa=this.kDc=this.hDa=this.wL=this.$fe=null;this.pv=new S.a(null,null);this.YVb=B.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthVNext",!1);this.BWa="SharedAuthTokenStrategy "+(this.YVb?"BrowserAuth 1.20210701.2/MSAL 2.11.0":"BrowserAuth 1.20210426.1/MSAL 2.11.0");
this.MX=U.a.Fnj;this.$de=U.a.Enj;this.a3d=U.a.enableConsoleLogging;this.Cjg=B.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthPopupFlashEnabled",!1);this.Trg=B.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthSkipUpnCheckEnabled",this.YVb);this.mqa={};this.amg=new l(1500)}function k(pa,Ia,Ma,lb,zb,Ya,Wb){var Zb=ca.call(this,!1,!1,!0)||this;Zb.b1=null;Zb.p2d=null;Zb.MX=pa;Zb.Dpg=Ma;Zb.pv=lb;Zb.ttg=zb;Zb.hDa=Ya;Zb.ls=document.createElement("iframe");
Zb.ls.id="SharedAuthInteractiveFrame";Zb.ls.setAttribute("name","SharedAuthInteractiveFrame");Zb.ls.setAttribute("title","SharedAuthInteractiveFrame");Zb.ls.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");Zb.ls.style.border="0";Zb.ls.style.height="48px";Zb.ls.style.width="190px";$addHandler(Zb.ls,"error",Object(ia.a)(Zb,Zb.pKi,"onSharedAuthFrameError"));pa=String.format("{0}{1}{2}{3}{4}{5}{6}{7}{8}",Zb.MX,Ia,"?replyUrl=",window.location.protocol,"//",window.location.host,
"&interactive=1","&WacUserType=",B.AFrameworkApplication.userType);Wb&&(pa+="&vnext=1");Zb.ls.src=pa;Zb.ijg=new Promise(function(da){Zb.p2d=da});Zb.q2d=!1;return Zb}function n(){this.correlationId=this.resolve=null}function l(pa){pa=void 0===pa?0:pa;this.lB=0;this.zjb=!1;this.vm=new R.a;this._timeout=pa}function f(){this.reject=this.resolve=null;this.startTime=0;this.pGf=this.Gqe=null}function u(){this.ahe=null;var pa=B.AFrameworkApplication.ga.Ua(B.AFrameworkApplication.Pna),Ia=B.AFrameworkApplication.ga.Ua(B.AFrameworkApplication.W7f);
this.BWa=String.format("ParentFrameTokenStrategy uiHost={0} uiHostIntegrationType={1}",pa&&""!==pa?pa:"Unspecified",Ia&&""!==Ia?Ia:"Unspecified")}function v(pa,Ia,Ma,lb,zb){this.scope=this.resource=null;this.silentLogin=!1;this.correlationId=this.options=null;this.resource=pa;this.scope=Ia;this.silentLogin=Ma;this.options=lb;this.correlationId=zb}function m(){}function A(pa){this.Wng=pa}function x(){}b.r(D);y=b(0);var t=b(13),z=b(815),r=b(1056),G;(function(pa){pa[pa.external=0]="external";pa[pa.msa=
1]="msa";pa[pa.aad=2]="aad"})(G||(G={}));Object(y.b)("AuthorityType",G);Object(y.a)(x,"OAuthResult",null,[]);A.prototype.initialize=function(){return Promise.resolve(0)};A.prototype.cic=function(){return Promise.resolve(0)};A.prototype.XR=function(){t.ULS.sendTraceTag(574239257,3E3,50,"Automation flag set.  Returning Mock Token.");return Promise.resolve(Object.assign(new x,{IsSuccess:!0,Token:this.Wng}))};A.prototype.Nyc=function(){return Promise.resolve(Object.assign(new x,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",
ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};A.prototype.rxc=function(){return!1};A.prototype.Oub=function(){return"MockAuthTokenStrategy"};Object(y.a)(A,"MockAuthTokenStrategy",null,[785]);var w=b(1083);m.get=function(pa,Ia,Ma){if(!Ma)return pa;var lb=0;return Promise.race([pa,new Promise(function(zb){lb=window.setTimeout(function(){zb(Ia)},Ma)})]).then(function(zb){window.clearTimeout(lb);return Promise.resolve(zb)}).catch(function(){window.clearTimeout(lb);
return Promise.resolve(Ia)})};Object(y.a)(m,"PromiseWithTimeout",null,[]);var B=b(5),U=b(857);Object(y.a)(v,"TokenRequestParameters",null,[350]);var N=b(23),P=b(86);u.prototype.initialize=function(){var pa=this;return new Promise(function(Ia){P.a.instance.mc("Common.App.WopiIdentity.IWopiIdentity").execute(function(Ma){pa.ahe=Ma;Ia(0)})})};u.prototype.ii=function(pa){for(var Ia=!1,Ma=pa.toLocaleUpperCase(),lb=yl(["HTTPS:","API:"]),zb=lb.next();!zb.done;zb=lb.next())if(Ma.startsWith(zb.value)){Ia=
!0;break}return Ia||this.mbi(pa)?pa+"/.default":pa};u.prototype.mbi=function(pa){return RegExp("/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i").test(pa)};u.prototype.cic=function(){return Promise.resolve(0)};u.prototype.XR=function(pa,Ia,Ma,lb,zb,Ya,Wb){if(N.a.qka){zb=U.a.HOj;if(!zb)return Ia=Object.assign(new x,{IsSuccess:!1,ErrorCode:"TeamsNoAllowListFound",ErrorMessage:"No app list was found."}),Promise.resolve(Ia);if(!Array.contains(zb,pa))return Ia=Object.assign(new x,
{IsSuccess:!1,ErrorCode:"TeamsDisallowedApp",ErrorMessage:"Disallowed appName: "+pa}),Promise.resolve(Ia)}pa=this.ii(Ma);Ma=new v(Ma,pa,!lb,null,B.AFrameworkApplication.userSessionId);return this.ahe.getAccessToken(Ma,Ia,Wb).then(function(Zb){return Object.assign(new x,{IsSuccess:!0,Token:Zb.accessToken})},function(Zb){return Object.assign(new x,{IsSuccess:!1,ErrorCode:Zb})})};u.prototype.Nyc=function(){return Promise.resolve(Object.assign(new x,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",
ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};u.prototype.rxc=function(){return!1};u.prototype.Oub=function(){return this.BWa};Object(y.a)(u,"ParentFrameTokenStrategy",null,[785]);var ia=b(80),W=b(991),R=b(185);Object(y.a)(f,"PromiseWrapper",null,[]);l.prototype.enqueue=function(pa){var Ia=this;return new Promise(function(Ma,lb){Ia.vm.add(Object.assign(new f,{pGf:pa,resolve:Ma,reject:lb}));Ia.process()})};l.prototype.process=function(){var pa=
this;if(this.zjb||this.lB===this.vm.count)return!1;var Ia=this.vm.na(this.lB++);try{this.zjb=!0,Ia.pGf().then(function(Ma){pa.zjb=!1;pa.k0c(Ia,Ma,null,!0)}).catch(function(Ma){pa.zjb=!1;pa.k0c(Ia,null,Ma,!1)})}catch(Ma){this.zjb=!1,this.k0c(Ia,null,Ma,!1)}return!0};l.prototype.k0c=function(pa,Ia,Ma,lb){var zb=this;lb?0<this._timeout?window.setTimeout(function(){pa.resolve(Ia);zb.process()},this._timeout):(pa.resolve(Ia),zb.process()):0<this._timeout?window.setTimeout(function(){pa.reject(Ma);zb.process()},
this._timeout):(pa.reject(Ma),zb.process())};Object(y.a)(l,"PromiseQueue",null,[]);Object(y.a)(n,"ResolveWithCorrelation",null,[]);var I=b(84),Q=b(140),O=b(962),ba=b(170),ca=Q.a;vm(k,ca);k.prototype.Hvc=function(){var pa={};pa=(pa.promptMessage=this.Dpg,pa.errorText=CommonUIStrings.l_InternalError,pa.rtl=B.AFrameworkApplication.isRtl,pa.frameLoaded=!1,pa.createFrame=Object(ia.a)(this,this.O1g,"createFrame"),pa.resolveDialogStyles=this.p2d,pa);var Ia={};this.b1=(Ia.id="SharedAuthConsentDialog",Ia.bodyControls=
pa,Ia);this.kc=5;this.initializeAndShow(CommonUIStrings.l_SignIn,Object(ia.a)(this,this.Dnj,"sharedAuthConsentDialogHandler"),this.b1)};k.prototype.I$f=function(pa,Ia){var Ma=!0;Ma=void 0===Ma?!1:Ma;pa=void 0===pa?!1:pa;Ia=void 0===Ia?5:Ia;this.b1&&this.b1.bodyControls&&(Ma!==Object(I.a)(Object,this.b1.bodyControls).frameLoaded&&(Object(I.a)(Object,this.b1.bodyControls).frameLoaded=Ma),pa!==Object(I.a)(Object,this.b1.bodyControls).frameLoadSuccess&&(Object(I.a)(Object,this.b1.bodyControls).frameLoadSuccess=
pa),Ia!==this.b1.dialogButtonsOption&&(this.b1.dialogButtonsOption=null,this.kc=Ia),this.update(this.b1))};k.prototype.Rtj=function(pa,Ia){var Ma=new O.a(ba.a.Hnj),lb={};pa=(lb.signInLabel=CommonUIStrings.l_SignIn,lb.cancelLabel=CommonUIStrings.l_DialogCancel,lb.rtl=B.AFrameworkApplication.isRtl,lb.messageCorrelationId=pa,lb.dialogStyles=Ia,lb);Ma.Values=pa;this.pv.uQa(Ma,this.ls.contentWindow,this.MX)};k.prototype.WRe=function(){this.I$f(!1,6)};k.prototype.pKi=function(){this.WRe()};k.prototype.O1g=
function(){return this.ls};k.prototype.Dnj=function(pa){pa||(this.ttg.reject(Object.assign(new x,{ErrorCode:"UserCancelled",ErrorMessage:"The interactive flow was cancelled by the user"})),this.hDa(null))};tl.Object.defineProperties(k.prototype,{XXf:{configurable:!0,enumerable:!0,get:function(){return this.ls}},hah:{configurable:!0,enumerable:!0,get:function(){var pa=this;return this.ijg.then(function(Ia){pa.q2d=!0;return Ia})}},iah:{configurable:!0,enumerable:!0,get:function(){return this.q2d}}});
Object(y.a)(k,"SharedAuthConsentDialog",Q.a,[798]);var S=b(1254),Y=b(93),ma=b(47),Z=b(179),xa=b(178);c.prototype.Oub=function(){return this.BWa};c.prototype.initialize=function(){var pa=b(985).OAuthManager;if("loadFrame"in this.mqa)return this.mqa.loadFrame.Gqe;if(!this.MX)return Y.Health.instance.recordKpiFailure(pa.kpiName,"SharedAuthFrameOriginNotSet",!1,!1,null),t.ULS.sendTraceTag(562381581,3E3,10,"SharedAuthTokenStrategy Init failed: No Shared Frame Origin Path"),Promise.reject(1);pa=this.$wc("loadFrame");
this.oRb=ma.a.me();var Ia=this.MX+this.$de+"?replyUrl="+window.location.protocol+"//"+window.location.host+"&usid="+B.AFrameworkApplication.userSessionId+"&WacUserType="+B.AFrameworkApplication.userType;this.YVb&&(Ia+="&vnext=1");this.ls=document.createElement("iframe");this.f4h(this.ls);this.ls.style.cssText="height:0;width:0;display:none;";this.ls.id="SharedAuthFrame";this.ls.setAttribute("name","SharedAuthFrame");this.ls.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");
this.ls.setAttribute("title","SharedAuthFrame");this.ls.src=Ia;document.body.appendChild(this.ls);Ia=ma.a.me()-this.oRb;t.ULS.sendTraceTag(573112899,3E3,50,"SharedAuthTokenStrategy Create: Frame Appended to Document. E/T:[{0}]. sharedAuthFrame.Src={1}",Ia,this.ls.src);return pa};c.prototype.cic=function(pa){this.kDc=pa;var Ia=new O.a(ba.a.$Xf);Ia.Values=this.gqe(pa);pa=this.$wc("initFrame");this.pv.uQa(Ia,this.ls.contentWindow,this.MX);t.ULS.sendTraceTag(573112900,3E3,50,"SharedAuthTokenStrategy Init: Called package initialize.");
return pa};c.prototype.XR=function(pa,Ia,Ma,lb,zb,Ya){var Wb=this,Zb=new O.a(ba.a.Inj),da=this.YZe();Zb.Values=this.s7f(pa,Ia,Ma,lb,zb,Ya,da);pa=this.$wc(da);lb&&B.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthInteractiveConsentUI",!1)?this.amg.enqueue(function(){return new Promise(function(za){Wb.uFj(Ya,Zb,za,da)})}):(this.pv.uQa(Zb,this.ls.contentWindow,this.MX),t.ULS.sendTraceTag(573112901,3E3,50,"SharedAuthTokenStrategy TryGetToken: Called TryGetToken for app {0}",
Ia));return pa};c.prototype.uFj=function(pa,Ia,Ma,lb){var zb=this.mqa[lb];zb&&(this.OWa=Ia,this.hDa=Object.assign(new n,{resolve:Ma,correlationId:lb}),this.wL=new k(this.MX,this.$de,pa,this.pv,zb,Ma,this.YVb),this.wL.Hvc())};c.prototype.YZe=function(){return Z.a.create().toString()};c.prototype.s7f=function(pa,Ia,Ma,lb,zb,Ya,Wb){var Zb={};Zb.appName=pa;Zb.appId=Ia;Zb.target=Ma;Zb.withPopup=lb;Zb.claims=zb;Zb.promptMessage=Ya;Zb.messageCorrelationId=Wb;return Zb};c.prototype.f4h=function(pa){$addHandler(pa,
"load",Object(ia.a)(this,this.mFi,"onIFrameLoaded"));$addHandler(pa,"error",Object(ia.a)(this,this.Flc,"onIFrameError"));this.pv.TEa(this.MX);this.pv.Pn(ba.a.cYf);this.pv.Km(ba.a.cYf,Object(ia.a)(this,this.KJi,"onScriptLoaded"));this.pv.Pn(ba.a.bYf);this.pv.Km(ba.a.bYf,Object(ia.a)(this,this.JJi,"onScriptInitialized"));this.pv.Pn(ba.a.YXf);this.pv.Km(ba.a.YXf,Object(ia.a)(this,this.QEi,"onGetTokenResponse"));this.pv.Pn(ba.a.dYf);this.pv.Km(ba.a.dYf,Object(ia.a)(this,this.IGi,"onLoginResponse"));this.pv.Pn(ba.a.aYf);
this.pv.Km(ba.a.aYf,Object(ia.a)(this,this.IFi,"onInteractiveFlowReady"));this.pv.Pn(ba.a.ZXf);this.pv.Km(ba.a.ZXf,Object(ia.a)(this,this.fFi,"onHideDialog"));this.pv.Pn(ba.a.WXf);this.pv.Km(ba.a.WXf,Object(ia.a)(this,this.uAi,"onCloseDialog"))};c.prototype.$wc=function(pa){var Ia=new f;Ia.startTime=ma.a.me();var Ma=new Promise(function(lb,zb){Ia.resolve=lb;Ia.reject=zb});Ia.Gqe=Ma;this.mqa[pa]=Ia;return Ma};c.prototype.mFi=function(){var pa=ma.a.me()-this.oRb;t.ULS.sendTraceTag(572346566,3E3,50,
"WACOAuth.aspx iFrame loaded successfully. E/T:[{0}]",pa)};c.prototype.Flc=function(pa){var Ia=b(985).OAuthManager,Ma=ma.a.me()-this.oRb,lb=Object.assign(new xa.a,{durationMs:Ma});Y.Health.instance.recordKpiFailure(Ia.kpiName,"SharedAuthWACOAuthAspxFrameError",!1,!0,lb);t.ULS.sendTraceTag(572346567,3E3,10,"WACOAuth.aspx iFrame failed to load after {0} ms: {1}",Ma,this.a3d?JSON.stringify(pa):"")};c.prototype.KJi=function(pa){var Ia=b(985).OAuthManager,Ma=this.mqa.loadFrame,lb=ma.a.me()-Ma.startTime,
zb=pa.Values.AuthLibrary.toString();pa=pa.Values.Success.toString();t.ULS.sendTraceTag(573112902,3E3,50,"SharedAuthTokenStrategy OnScriptLoaded. Success={0} AuthLibrary={1} E/T: [{2}]",pa,zb,lb);zb&&(this.BWa="SharedAuthTokenStrategy "+zb);zb=Boolean.parse(pa);zb||(pa=this.kq(),void 0!==pa&&null!==pa&&(pa.set("AuthLibrary",this.Oub()),lb=Object.assign(new xa.a,{durationMs:lb,extendedProperties:pa}),Y.Health.instance.recordKpiFailure(Ia.kpiName,"SharedAuthStrategyInitFailed",!1,!0,lb)));Ma.resolve(zb?
0:1)};c.prototype.JJi=function(pa){var Ia=this;if(pa.Values.interactive&&this.OWa&&this.OWa.Values.messageCorrelationId){var Ma=this.OWa.Values.messageCorrelationId.toString();if(pa.Values.interactive&&this.wL){this.wL.hah.then(function(zb){Ia.pv.uQa(Ia.OWa,Ia.wL.XXf.contentWindow,Ia.MX);Ia.wL.Rtj(Ma,zb);Ia.wL.I$f(!0);Ia.OWa=null});return}}pa=this.mqa.initFrame;var lb=ma.a.me()-pa.startTime;t.ULS.sendTraceTag(573112903,3E3,50,"SharedAuthTokenStrategy OnScriptInitialized. E/T: [{0}]",lb);pa.resolve(0)};
c.prototype.QEi=function(pa){if(pa.Values.messageCorrelationId&&pa.Values.messageCorrelationId.toString()){var Ia=pa.Values.messageCorrelationId.toString(),Ma=this.mqa[Ia];if(Ma){var lb=ma.a.me()-Ma.startTime;t.ULS.sendTraceTag(573112906,3E3,50,"SharedAuthTokenStrategy OnGetTokenResponse. E/T: [{0}]",lb);pa.Values.isSuccess&&pa.Values.isSuccess?Ma.resolve(pa.Values.response):Ma.reject(pa.Values.response);this.H7f(Ia)}else t.ULS.sendTraceTag(573112905,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called with an unregistered messageCorrelationId")}else t.ULS.sendTraceTag(573112904,
3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called without valid messageCorrelationId")};c.prototype.IFi=function(){if(this.wL.iah)this.wL.WRe();else if(this.kDc&&this.wL){var pa=new O.a(ba.a.$Xf);pa.Values=this.gqe(this.kDc,!0);this.pv.uQa(pa,this.wL.XXf.contentWindow,this.MX)}};c.prototype.fFi=function(){this.wL&&this.wL.Yvb()};c.prototype.uAi=function(pa){pa.Values.cancelled&&pa.Values.cancelled&&pa.Values.messageCorrelationId&&this.H7f(pa.Values.messageCorrelationId.toString());this.wL&&
this.wL.hide()};c.prototype.kq=function(){try{return new Map}catch(pa){return null}};c.prototype.gqe=function(pa,Ia){Ia=void 0===Ia?!1:Ia;var Ma={};Ma.appIds=this.QCh();Ma.upn=pa.loginHint;Ma.authority=pa.authority;Ma.authorityType=Object(z.a)(G,pa.authorityType);Ma.tenantId=pa.tenantId;Ma.correlationId=B.AFrameworkApplication.userSessionId;Ma.enableConsoleLogging=this.a3d;Ma.enablePopupFlash=this.Cjg;Ma.skipUpnCheck=this.Trg;Ma.interactive=Ia;return Ma};c.prototype.QCh=function(){var pa=[],Ia=U.a.EUc,
Ma;for(Ma in Ia)Array.add(pa,Ia[Ma]);return pa};c.prototype.Nyc=function(pa,Ia,Ma,lb,zb,Ya){var Wb=new O.a(ba.a.Gnj),Zb=this.YZe();Wb.Values=this.s7f(pa,Ia,Ma,lb,zb,Ya,Zb);this.$fe=Wb;pa=this.$wc(Zb);t.ULS.sendTraceTag(555049437,3E3,50,"SharedAuthTokenStrategy TryLogin: Called TryLogin for app {0}",Ia);this.urj();return pa};c.prototype.rxc=function(){return!0};c.prototype.urj=function(){var pa=this;this.Gib||(this.Gib=new W.a(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Title,CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Body,
null),this.Gib.id=16,this.Gib.Sbf=!1,this.Gib.addButton(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,function(){t.ULS.sendTraceTag(527827290,3E3,50,"SharedAuthTokenStrategy TryLogin: User Clicked Login");pa.pv.uQa(pa.$fe,pa.ls.contentWindow,pa.MX)},CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,!0),t.ULS.sendTraceTag(555049438,3E3,10,"Failed to add entry to business bar. Login message could not be shown to user."))};c.prototype.IGi=function(pa){if(pa.Values.messageCorrelationId&&pa.Values.messageCorrelationId.toString()){var Ia=
this.mqa[pa.Values.messageCorrelationId.toString()];if(Ia){var Ma=ma.a.me()-Ia.startTime;t.ULS.sendTraceTag(555049441,3E3,50,"SharedAuthTokenStrategy OnLoginResponse. E/T: [{0}]",Ma);pa.Values.isSuccess&&pa.Values.isSuccess?Ia.resolve(pa.Values.response):Ia.reject(pa.Values.response)}else t.ULS.sendTraceTag(555049440,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called with an unregistered messageCorrelationId")}else t.ULS.sendTraceTag(555049439,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called without valid messageCorrelationId")};
c.prototype.H7f=function(pa){this.hDa&&this.hDa.correlationId===pa&&(this.hDa.resolve(null),this.hDa=null)};Object(y.a)(c,"SharedAuthTokenStrategy",null,[785]);d.prototype.initialize=function(){return Promise.resolve(0)};d.prototype.cic=function(){return Promise.resolve(0)};d.prototype.XR=function(){return Promise.resolve(Object.assign(new x,{IsSuccess:!1,ErrorCode:r.a[this.yNc],ErrorMessage:"Unable to get a token. Reason: ["+r.a[this.yNc]+"]"}))};d.prototype.Nyc=function(){return Promise.resolve(Object.assign(new x,
{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};d.prototype.rxc=function(){return!1};d.prototype.Oub=function(){return this.BWa};Object(y.a)(d,"UnsupportedAuthTokenStrategy",null,[785]);var na=b(846);b.d(D,"OAuthManager",function(){return a});a.prototype.v$g=function(){var pa=U.a.iti;pa&&0<pa.length?(this.hS=1,this.vO=new A(pa)):B.AFrameworkApplication.ga.ra("IsO365ConsumerHost")||B.AFrameworkApplication.ga.ra("IsO365CommercialHost")?
B.AFrameworkApplication.ga.ra("IsAnonymousUser")?(this.hS=2,this.vO=new d(this.hS)):(pa=w.a.getAuthContext().loginHint)&&pa.length?U.a.awb?(this.hS=1,this.vO=new u):(this.hS=1,this.vO=new c):(this.hS=3,this.vO=new d(this.hS)):(this.hS=4,this.vO=new d(this.hS))};a.prototype.Cu=function(){return this.vO?this.vO.Oub()||"Unknown":"None"};a.prototype.u$g=function(pa){var Ia=this;pa=void 0===pa?null:pa;t.ULS.sendTraceTag(562128578,3E3,50,"Creating OAuthManager.");var Ma=ma.a.me();return B.AFrameworkApplication.ga.Pcd().then(function(lb){lb?
(Ia.v$g(),pa&&(Ia.vO=pa),t.ULS.sendTraceTag(42084323,3E3,50,"Creation succeeded OAuthManager successfully in {4} ms with clientVer={0}, appVer={1}, docVer={2}, strategy={3}",U.a.clientVersion,U.a.appVersion,U.a.Bch,Ia.Cu(),Math.floor(ma.a.me()-Ma))):t.ULS.sendTraceTag(562128579,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(ma.a.me()-Ma));return Promise.resolve(lb)},function(){t.ULS.sendTraceTag(562128580,3E3,
15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(ma.a.me()-Ma));return Promise.resolve(!1)})};a.prototype.B2h=function(){var pa=this;t.ULS.sendTraceTag(573390991,3E3,50,"Initializing {0}",this.Cu());var Ia=ma.a.me();return m.get(this.vO.initialize(),2,U.a.jDd).then(function(Ma){if(Ma)if(1===Ma){t.ULS.sendTraceTag(527827291,3E3,15,"Initialization failed for {0} in {1} ms, all future TryGetToken requests will fail.",
pa.Cu(),Math.floor(ma.a.me()-Ia));var lb=pa.kq();void 0!==lb&&null!==lb&&(lb.set("AuthLibrary",pa.Cu()),lb=Object.assign(new xa.a,{durationMs:Math.floor(ma.a.me()-Ia),extendedProperties:lb}),Y.Health.instance.recordKpiFailure(a.kpiName,"StrategyInitFailed",!1,!0,lb))}else 2===Ma&&(t.ULS.sendTraceTag(42267908,3E3,15,"Initialization timed out for {0} after {1} ms, all future TryGetToken requests will fail.",pa.Cu(),Math.floor(ma.a.me()-Ia)),lb=pa.kq(),void 0!==lb&&null!==lb&&(lb.set("AuthLibrary",pa.Cu()),
lb=Object.assign(new xa.a,{durationMs:Math.floor(ma.a.me()-Ia),extendedProperties:lb}),Y.Health.instance.recordKpiFailure(a.kpiName,"StrategyInitTimedOut",!1,!0,lb)));else t.ULS.sendTraceTag(42084353,3E3,50,"Initialization succeeded for {0} in {1} ms.",pa.Cu(),Math.floor(ma.a.me()-Ia));return Promise.resolve(Ma)},function(){t.ULS.sendTraceTag(574239256,3E3,15,"Initialization failed for {0} after {1} ms, all future TryGetToken requests will fail.",pa.Cu(),Math.floor(ma.a.me()-Ia));return Promise.resolve(1)})};
a.prototype.Tki=function(){var pa=this;t.ULS.sendTraceTag(562128581,3E3,50,"Loading {0}",this.Cu());var Ia=ma.a.me();return m.get(this.vO.cic(w.a.getAuthContext()),2,U.a.jDd).then(function(Ma){if(Ma)if(1===Ma){t.ULS.sendTraceTag(562128583,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",pa.Cu(),Math.floor(ma.a.me()-Ia));var lb=pa.kq();void 0!==lb&&null!==lb&&(lb.set("AuthLibrary",pa.Cu()),lb=Object.assign(new xa.a,{durationMs:Math.floor(ma.a.me()-Ia),extendedProperties:lb}),
Y.Health.instance.recordKpiFailure(a.kpiName,"StrategyLoadFailed",!1,!0,lb))}else 2===Ma&&(t.ULS.sendTraceTag(558469660,3E3,15,"Load timed out for {0} after {1} ms, all future TryGetToken requests will fail.",pa.Cu(),Math.floor(ma.a.me()-Ia)),lb=pa.kq(),void 0!==lb&&null!==lb&&(lb.set("AuthLibrary",pa.Cu()),lb=Object.assign(new xa.a,{durationMs:Math.floor(ma.a.me()-Ia),extendedProperties:lb}),Y.Health.instance.recordKpiFailure(a.kpiName,"StrategyLoadTimedOut",!1,!0,lb)));else t.ULS.sendTraceTag(562128582,
3E3,50,"Load succeeded for {0} in {1} ms.",pa.Cu(),Math.floor(ma.a.me()-Ia));return Promise.resolve(Ma)},function(){t.ULS.sendTraceTag(562128584,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",pa.Cu(),Math.floor(ma.a.me()-Ia));return Promise.resolve(1)})};a.prototype.XR=function(pa,Ia,Ma){return this.Lyc(pa,Ia,!1,null,"",void 0===Ma?null:Ma)};a.prototype.t7f=function(pa,Ia,Ma,lb,zb){return this.Lyc(pa,Ia,!0,Ma,lb,void 0===zb?null:zb)};a.prototype.Lyc=function(pa,
Ia,Ma,lb,zb,Ya,Wb){Wb=void 0===Wb?0:Wb;Wb+=1;t.ULS.sendTraceTag(42084352,3E3,50,"OAuthManager TryGetToken(appName={0}, target={1}) called.  Using strategy {2} - attempt {3}",pa,this.fQa(pa,Ia),this.Cu(),Wb);var Zb=this.kq();void 0!==Zb&&null!==Zb&&(Zb.set("AuthLibrary",this.Cu()),Zb.set("AppName",pa),Zb.set("Target",this.fQa(pa,Ia)),Y.Health.instance.recordKpiUsage(a.kpiName,0,"WacOAuthFC",Zb));if(!U.a.isEnabled){var da;return this.Yrd((da=new x,da.IsSuccess=!1,da.Token=null,da.ErrorCode="NotEnabled",
da.ErrorMessage="OAuthManager is disabled.",da),pa)}var za=U.a.EUc[pa];if(void 0===za||null===za){t.ULS.sendTraceTag(41961345,3E3,15,"Auth context not found. Ensure that your app [{0}] is listed in the OAuthManagerApplications setting.",pa);var hb;return this.Yrd((hb=new x,hb.IsSuccess=!1,hb.Token=null,hb.ErrorCode="DisallowedApp",hb.ErrorMessage="Disallowed appName: "+pa,hb),pa)}var Gb=ma.a.me(),Sb=this;Zb=this.Qlg.then(function(sa){return Sb.f8h(pa,za,Ia,Ma,lb,zb,Ya,sa)});da=Ma?0:U.a.jDd;var Fb;
hb=(Fb=new x,Fb.IsSuccess=!1,Fb.Token=null,Fb.ErrorCode="authTokenStrategy_timeout",Fb.ErrorMessage="Auth Strategy timed out after ["+da+"] ms when fetching token",Fb);var wa=this,va=this;return m.get(Zb,hb,da).then(function(sa){return Wb<=a.Dri&&(sa.ErrorCode===a.C5f||sa.ErrorCode===a.tyj)?(t.ULS.sendTraceTag(573175516,3E3,50,"TryGetToken attempt {0} timed out after {1} ms - retrying",Wb,Math.floor(ma.a.me()-Gb)),wa.Lyc(pa,Ia,Ma,lb,zb,Ya,Wb)):sa.ErrorCode===a.kff&&!Ma&&(t.ULS.sendTraceTag(561517645,
3E3,50,"TryGetToken attempt {0} failed with ITP error.  3P Cookies are [{1}]. Retry: [{2]}]",Wb,a.jIe),a.agh&&wa.vO.rxc()&&wa.vO.Nyc(pa,za,Ia,Ma,lb,zb).then(function(sb){return Promise.resolve(wa.wic(sb,pa,Ia,za,Gb))}).catch(function(){var sb,Tb=(sb=new x,sb.IsSuccess=!1,sb.Token=null,sb.ErrorCode="authTokenStrategy_failure",sb.ErrorMessage="LoginPopup failed, GetToken could not be called",sb);return Promise.resolve(wa.wic(Tb,pa,Ia,za,Gb))}),a.jIe)?wa.Lyc(pa,Ia,!0,lb,zb,Ya,Wb):Promise.resolve(wa.wic(sa,
pa,Ia,za,Gb))}).catch(function(){var sa,sb=(sa=new x,sa.IsSuccess=!1,sa.Token=null,sa.ErrorCode="authTokenStrategy_failure",sa.ErrorMessage="Auth Strategy failed with an unknown error",sa);return Promise.resolve(va.wic(sb,pa,Ia,za,Gb))})};a.prototype.f8h=function(pa,Ia,Ma,lb,zb,Ya,Wb,Zb){var da=this;return 1===Zb||2===Zb?this.Yrd(Object.assign(new x,{IsSuccess:!1,Token:null,ErrorCode:1===Zb?"InitFailed":"InitTimedOut",ErrorMessage:"Auth Strategy Failed to Init or Load"}),pa):this.vO.XR(pa,Ia,Ma,lb,
zb,Ya,Wb).then(function(za){return Promise.resolve(da.Aof(za,!0,pa))}).catch(function(za){return Promise.resolve(da.Aof(za,!1,pa))})};a.prototype.wic=function(pa,Ia,Ma,lb,zb){var Ya={};zb=ma.a.me()-zb;Ya.IsSuccess=pa.IsSuccess;Ya.ErrorCode=pa.IsSuccess?"Success":pa.ErrorCode||"";Ya.ErrorMessage=pa.IsSuccess?"Success":this.fQa(Ia,pa.ErrorMessage||"");Ya.Target=this.fQa(Ia,Ma||"");Ya.TimeInMS=Math.floor(zb);Ya.AuthLibrary=this.Cu();Ya.AppName=Ia;Ya.AuthorityType=Object(z.a)(G,w.a.w9b());Ya.UserType=
this.fUh(w.a.getAuthContext());Ya.IsAuthSupportedInSession=r.a[this.hS];Ya.RequestCount=++this.jqg;Ya.AppId=lb;t.ULS.sendTraceTag(593863640,3E3,50,JSON.stringify(Ya));pa.IsSuccess||(Ma=this.kq(),void 0!==Ma&&null!==Ma&&(Ma.set("AppName",Ia),Ma.set("AuthLibrary",this.Cu()),Ma.set("ErrorCode",pa.ErrorCode),Ma.set("ErrorMessage",this.fQa(Ia,pa.ErrorMessage)),Ia=Object.assign(new xa.a,{durationMs:zb,extendedProperties:Ma}),Y.Health.instance.recordKpiFailure(a.kpiName,"TryGetTokenFailure",!1,!0,Ia)));
return pa};a.prototype.Yrd=function(pa,Ia){t.ULS.sendTraceTag(578435090,3E3,15,"OAuthManager failed without invoking GetToken. AppName: '{0}', Reason: '{1}'",Ia,this.fQa(Ia,pa.ErrorMessage));var Ma=this.kq();void 0!==Ma&&null!==Ma&&(Ma.set("AppName",Ia),Ma.set("AuthLibrary",this.Cu()),Ma.set("ErrorCode",pa.ErrorCode),Ma.set("ErrorMessage",this.fQa(Ia,pa.ErrorMessage)),Ia=Object.assign(new xa.a,{extendedProperties:Ma}),Y.Health.instance.recordKpiFailure(a.kpiName,"FailureBeforeGetToken",!1,!0,Ia));
return Promise.resolve(pa)};a.prototype.Baf=function(pa){return pa===na.a.ayc};a.prototype.fQa=function(pa,Ia){return this.Baf(pa)&&Ia?"REDACTED":Ia};a.prototype.fUh=function(pa){return B.AFrameworkApplication.ga.ra("IsAnonymousUser")?"anonymous":!pa.loginHint||1>pa.loginHint.length?"empty":-1<pa.loginHint.indexOf("guest#")?"guest":-1<pa.loginHint.indexOf("ext#")?"external":0>pa.upn.indexOf("@")?"no-at":"supported"};a.prototype.gLa=function(){return 1===this.hS};a.prototype.Aof=function(pa,Ia,Ma){var lb=
null,zb=null,Ya=null,Wb=null;pa?pa.ErrorCode||pa.ErrorMessage?(zb=pa.ErrorCode?pa.ErrorCode:a.fOe,Ya=pa.ErrorMessage?pa.ErrorMessage:"No message"):pa.Token?Ia?lb=pa.Token:(zb=a.W1i,Ya="A rejected promise returned a token."):(zb=a.fOe,Ya=JSON.stringify(pa)):(zb=a.Fvi,Ya="No result came from Auth Token Strategy");pa&&pa.Telemetry&&!this.Baf(Ma)&&(Wb=pa.Telemetry,t.ULS.sendTraceTag(579166408,3E3,50,JSON.stringify(Wb)));if(zb===a.uti||zb===a.WCj)zb=a.C5f,Ya="Auth Library Timed Out";zb===a.jIg&&-1<Ya.indexOf(a.jug)&&
(zb=a.kff);if(zb||Ya)lb=null;return Object.assign(new x,{IsSuccess:!!lb,Token:lb,ErrorCode:zb,ErrorMessage:Ya,Telemetry:Wb})};a.prototype.kq=function(){try{return new Map}catch(pa){return null}};tl.Object.defineProperties(a,{jIe:{configurable:!0,enumerable:!0,get:function(){return B.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthInteractiveFallbackEnabled",!1)}},agh:{configurable:!0,enumerable:!0,get:function(){return B.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthLoginFlowEnabled",
!1)}}});a.WCj="token_renewal_error";a.fOe="Exception";a.Fvi="NoResult";a.W1i="RejectToken";a.uti="monitor_window_timeout";a.C5f="Timeout";a.tyj="authTokenStrategy_timeout";a.jIg="login_required";a.jug="AADSTS50058";a.kff="Cookies Disabled";a.kpiName="OAuthManager";a.Dri=2;Object(y.a)(a,"OAuthManager",null,[685])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDS.oauth.js.map/86ba853fd40d3164edef679cf3ba71a3/EwaDS.oauth.js.map
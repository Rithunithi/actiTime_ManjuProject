(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[14],{1072:function(y,D,b){function a(z){var r=this;this.$=z;(this.Al=this.$.da.Aa(268))||c.ULS.shipAssertTag(537170070,0,!1,"CalcHelper constructor - IInstantaneousSupportInformationManager is not available");var G=m.EwaSettings.isChangeGateEnabled("OfficeVSO:5543503_loadCalcCurrentVersion")?v.a.current.co(53):v.a.current.co(56);this.logger=new u.a;this.documentLoc=excelOnlineCalc.location.documentLoc("",this.$.workbookContext.FullDocumentInfo.BreadcrumbDocName);
this.sba=new d(z,this.Al);excelOnlineCalc.config.initCalc(this.logger,this.Al?function(w){return r.Al.isFeatureEnabled(w)}:function(){return!1},G);this.oig=excelOnlineCalc.config.calcConfig(this.sba.localeInfo)}function d(z,r){z=b(1072).CalcHelper;r&&(r.He||c.ULS.shipAssertTag(537169942,0,!1,"LocaleHolder constructor - locale information is not available"));this.wng=z.mBe(r,z.aBe(r.Jia));this.xng=excelOnlineCalc.calc.localeInfoFromData(this.localeData)}b.r(D);y=b(0);var c=b(13),k=b(308),n;(function(z){z[z.paren=
0]="paren";z[z.lead=1]="lead";z[z.intern=2]="intern";z[z.trail=3]="trail";z[z.undefined=4]="undefined"})(n||(n={}));Object(y.b)("CurrencyFormatOption",n);var l;(function(z){z[z.none=-1]="none";z[z.mdy=0]="mdy";z[z.dmy=1]="dmy";z[z.ymd=2]="ymd";z[z.myd=3]="myd";z[z.dym=4]="dym";z[z.ydm=5]="ydm"})(l||(l={}));Object(y.b)("DateOrderOption",l);var f=b(9);d.prototype.formatNumber=function(z){return this.localeInfo.formatNumber(z)};tl.Object.defineProperties(d.prototype,{localeInfo:{configurable:!0,enumerable:!0,
get:function(){return this.xng}},localeData:{configurable:!0,enumerable:!0,get:function(){return this.wng}}});Object(y.a)(d,"LocaleHolder",null,[]);var u=b(1131),v=b(51),m=b(1),A=b(19),x=b(14),t=b(193);b.d(D,"CalcHelper",function(){return a});a.prototype.V6g=function(){if(m.EwaSettings.isChangeGateEnabled("OfficeVSO:4986015_LetAutocompleteTelemetry")){if(!this.$.xa)return c.ULS.shipAssertTag(537170069,0,!1,"CalcHelper.CurrentSheetIndex() - this.ewaControl.Sheets is null"),0;var z=this.$.xa.oa;return z?
z.index:(c.ULS.shipAssertTag(537170068,0,!1,"CalcHelper.CurrentSheetIndex() - sheet is null"),0)}return this.$.xa.oa.index};a.prototype.createParser=function(){var z={};z.config=this.config;return excelOnlineCalc.parse.createParser(z)};a.prototype.createNumberFormatter=function(){var z=this,r=m.EwaSettings.isChangeGateEnabled("OfficeVSO:5935278_numberFormatterGetTime")?function(G,w){return excelOnlineCalc.calc.getTime(z.config,G,w,"Estimation")}:function(){return excelOnlineCalc.util.failure(excelOnlineCalc.util.notImplemented(["getTime"]))};
r=excelOnlineCalc.numfmt.createFormatGlobals(this.config,r);return excelOnlineCalc.numfmt.createNumberFormatter(r)};a.prototype.g5g=function(z,r,G){r=excelOnlineCalc.location.gridCell(r,G);z=excelOnlineCalc.location.sheetIndex(this.documentLoc,z);return excelOnlineCalc.location.sheetGridCell(z,r)};a.prototype.Rhh=function(z,r){var G=excelOnlineCalc.calc.getEvalResultKind(z);switch(G){case 4:return{returnValue:z?this.sba.localeInfo.trueName:this.sba.localeInfo.falseName,kind:G};case 1:return{returnValue:m.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?
this.Eyc(this.sba.formatNumber(z),r):this.sba.formatNumber(z),kind:G};case 2:return{returnValue:m.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.Eyc(z.toString(),r):z.toString(),kind:G};case 128:return{returnValue:"",kind:G};case 8:switch(z.type){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:return{returnValue:this.sba.localeInfo.errorNames[z.type],kind:G};default:return{returnValue:a.unknownError,kind:G}}case 32:return{returnValue:m.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?
this.Eyc(this.y5g(z,r),r):"##UNSUPPORTED: ARRAY",kind:G};default:return{returnValue:x.a.instance.ea(2146),kind:G}}};a.prototype.Eyc=function(z,r){return z.length<=r?z:z.substring(0,r-3)+"..."};a.prototype.y5g=function(z,r){for(var G=this.sba.localeInfo.leftBrace,w=0;w<z.rows;++w){for(var B=0;B<z.cols;++B)G+=z.opers[w][B],B<z.cols-1&&(G+=this.sba.localeInfo.columnSeparator);w<z.rows-1&&(G+=this.sba.localeInfo.rowSeparator)}return this.Eyc(G,r-1)+this.sba.localeInfo.rightBrace};a.mBe=function(z,r){r=
void 0===r?null:r;var G=a.N2b(),w=z.He.TrueValueString,B=z.He.FalseValueString,U=z.He.DecimalSeparator.toString(),N=z.He.ListSeparator.toString(),P=z.He.ColumnSeparator.toString(),ia=z.He.RowSeparator.toString(),W=z.He.ThousandsDataArray,R=z.He.ThousandSeparator.toString(),I=z.He.Lcid,Q=z.He.Country,O=z.He.DigitsNumber,ba=z.He.ExpSeparatedBySpace,ca=z.He.FractionSeparator.toString(),S=z.He.PercentSeparatedBySpace,Y=A.a.FQg(Enum.toString(n,z.He.CurrencyFormat)),ma=z.He.CurrencySymbolLead,Z=z.He.CurrencySeparatedBySpace,
xa=z.He.CurrencySymbolString,na=z.He.DigitsCurrency,pa=-1===z.He.DateOrder?"MDY":t.c(Enum.toString(l,z.He.DateOrder)),Ia=z.He.DateSeparator.toString(),Ma=z.He.DateAlternativeSeparator.toString(),lb=z.He.Year4Digits,zb=z.He.Month2Digits,Ya=z.He.Day2Digits,Wb=z.He.LongDateFormat,Zb=z.He.TimeSeparator.toString(),da=null==z.He.TimeAltSeparator?null:z.He.TimeAltSeparator.toString(),za=z.He.Hour2Digits,hb=z.He.Use24HourClock,Gb=z.He.AmPmSeparatedBySpace,Sb=[z.He.AmString,z.He.PmString],Fb=z.He.DayNameShortArray,
wa=z.He.DayNameLongArray,va=z.He.MonthNameShortArray,sa=z.He.MonthNameLongArray,sb=z.He.PictureSpecialArray,Tb=k.a.map(("\x00"+z.He.PictureSingleString).split(""),function(Zc){return"\x00"===Zc?null:Zc}),Da=z.He.PictureColorArray,Sa=z.He.PictureDbnumArray,Ra=z.He.RowLetter.toString(),Lb=z.He.ColumnLetter.toString(),Ja=z.He.LeftBrace.toString(),wb=z.He.RightBrace.toString(),Mb=z.He.LeftBracket.toString(),Eb=z.He.RightBracket.toString(),Ic=a.TRh(z.He);return excelOnlineCalc.calc.localeData(r,G,w,B,
Ra,Lb,Ja,wb,Mb,Eb,U,N,P,ia,W,R,I,Q,O,ba,ca,S,Y,ma,Z,xa,na,pa,Ia,Ma,lb,zb,Ya,Wb,Zb,da,za,hb,Gb,Sb,Fb,wa,va,sa,sb,Tb,Da,Sa,Ic,z.He.SysDateFormatString,z.He.SysTimeFormatString)};a.aBe=function(z){var r=[];if(!z)return r;z=yl(z);for(var G=z.next();!G.done;G=z.next()){G=G.value;var w=null;G.IsDynamicUdf||(w=excelOnlineCalc.calc.worksheetFunctionName(G.FunctionIndexInServer,G.NameUI));w&&Array.add(r,w)}return r};a.N2b=function(){for(var z=[],r=Object.keys(f.a.errorNames),G=0;G<r.length;G++){var w=excelOnlineCalc.calc.errorTypeName(G+
1,r[G]);w&&Array.add(z,w)}return z};a.TRh=function(z){var r=Array(6);r[1]="#"+z.AllStructRefString;r[3]="#"+z.HeadersStructRefString;r[2]="#"+z.DataStructRefString;r[4]="#"+z.TotalsStructRefString;r[5]="#"+z.ThisRowStructRefString;return r};tl.Object.defineProperties(a.prototype,{config:{configurable:!0,enumerable:!0,get:function(){return this.oig}}});a.unknownError="##ERR##";Object(y.a)(a,"CalcHelper",null,[])},1133:function(y,D,b){function a(){}b.d(D,"a",function(){return a});y=b(0);a.Oki="literal";
a.operator="operator";a.func="function";a.namedRange="namedRange";a.range="range";a.jhf="letName";a.all="*";a.pRd="structRefRange";Object(y.a)(a,"TraverseFormulaInterestTypes",null,[])},1134:function(y,D,b){function a(){}b.d(D,"a",function(){return a});y=b(0);a.cell="cell";a.range="range";a.row="row";a.column="col";Object(y.a)(a,"TraverseFormulaRefTypes",null,[])},1396:function(y,D,b){function a(ka){var bb=Nb.call(this)||this;bb.$=ka;bb.dc();return bb}function d(ka){var bb=vb.call(this)||this;bb.$=
ka;bb.dc();return bb}function c(ka,bb){var Ha=this;this.colors="rgba(95, 140, 237, {0});rgba(235, 94, 96, {0});rgba(141, 97, 194, {0});rgba(45, 150, 57, {0});rgba(191, 76, 145, {0});rgba(227, 130, 34, {0});rgba(55, 127, 158, {0})".split(";");this.q4a=this.O3f=!1;this.PBb=function(){Ha.q4a=!1};this.Nc=ka;this.gridView=zb.g(ka);this.calcManager=bb;this.nci=pa.EwaSettings.isChangeGateEnabled("OfficeVSO:5041666_ImplementLogRecorderOnEwaJS");this.fef=pa.EwaSettings.isChangeGateEnabled("OfficeVSO:5899330_SuspendResumeRichText");
this.y9e=pa.EwaSettings.la(721);this.gridView.Kc.hq(this.PBb)}function k(ka,bb,Ha,Ga){this.bBj=ka;this.T4f=bb;this.Xfc=void 0===Ga?!1:Ga;Ha?(this.G5a=Ha.IsRangeRef,this.Mva=Ha.IsAbsoluteFirstRow,this.Lva=Ha.IsAbsoluteFirstColumn,this.ZKa=Ha.IsAbsoluteSecondRow,this.YKa=Ha.IsAbsoluteSecondColumn):P.ULS.shipAssertTag(537169941,0,!1,"MarqueeMetadata.Ctor: parseResultItem is null")}function n(ka){var bb=rb.call(this)||this;bb.$=ka;bb.dc();return bb}function l(ka){var bb=this;this.rl=null;this.Xbg=!1;
this.PId=this.instantaneousSupportInformationManager=this.SDb=null;this.xpf={};this.Apf={};this.w$d=null;this.Slc=function(Ha){P.ULS.sendTraceTag(537170005,0,50,"CalcManager.OnLocaleInformationAvailable() called");Ha.YGd(bb.Slc);Ha.Jia.length?bb.wlc(Ha,Sys.EventArgs.Empty):(P.ULS.sendTraceTag(537170004,0,50,"CalcManager.OnLocaleInformationAvailable() - waiting for functions information"),Ha.Pke(bb.wlc))};this.wlc=function(Ha){P.ULS.sendTraceTag(537170003,0,50,"CalcManager.OnFunctionsInfoReady called");
Ha.MGd(bb.wlc);bb.wFj(Ha)};this.onContentReady=function(){bb.rl&&(bb.instantaneousSupportInformationManager&&bb.instantaneousSupportInformationManager.kkd||Zc.Task.delay(0).CWCT(function(){bb.rl.Rdb(1)},null,0,Pc.a.current))};this.arf=function(Ha,Ga){bb.rl&&(bb.instantaneousSupportInformationManager&&bb.instantaneousSupportInformationManager.kkd||bb.rl.sCe(Ga.$c.block))};P.ULS.sendTraceTag(537170067,0,50,"Creating CalcManager");this.S9e=!1;this.vb=ka;this.ny=zb.g(ka);this.UDc=null;this.gridView.Nq(this.onContentReady);
this.gridView.Ca.$Sc(this.arf);this.$.da.Za(268,function(Ha){Ha.He?(P.ULS.sendTraceTag(537170066,0,50,"CalcManager.ctor: LocaleInformation already available..."),bb.Slc(Ha,Sys.EventArgs.Empty)):(P.ULS.sendTraceTag(537170065,0,50,"CalcManager.ctor: waiting for LocaleInformation..."),Ha.ile(bb.Slc))})}function f(){}function u(){}function v(){this.YKa=this.ZKa=this.Lva=this.Mva=this.G5a=!1}function m(ka){var bb=this;this.yEd=null;this.Krd=this.xEd=this.RCb=!1;this.ACd=0;this.sCd=this.uCd=this.vCd=this.tCd=
-1;this.trueName="TRUE";this.falseName="FALSE";this.instantaneousSupportInformationManager=this.Nm=this.errorTypeNames=null;this.Kp=this.currentStateId=-1;this.Hsa="";this.p$=null;this.Owf=function(){bb.setNumberFormats()};this.od=function(){P.ULS.sendTraceTag(537170081,0,50,"CalcAsyncEngine.OnWorkbookOpened() called");bb.Xe=new Wb.a;bb.Kp=-1;bb.currentStateId=-1;bb.Hsa="";bb.vqb=null;bb.xEd=!1;bb.Nm&&bb.clearCache()};this.k1f=(this.Nc=ka)?ka.ya.CalcWebWorkerSmokeTestPingIntervalMS:this.k1f;this.Xe=
new Wb.a;this.vqb=null;this.documentLoc=excelOnlineCalc.location.documentLoc("",this.Nc.workbookContext.FullDocumentInfo.BreadcrumbDocName);this.Nna()}function A(ka){this.L0d=null;this.init(ka)}function x(){}function t(ka){this.Yma=ka;this.v5=new Sb.a(Fb.a.Ik());this.ckc=!1}function z(){this.nj=[];this.a9f=[];this.jZa={}}function r(ka,bb,Ha,Ga,Ua){this.type=ka;this.fullName=bb;this.range=Ha;this.sheetId=Ga;this.attributes=Ua;this.rG=null}function G(ka,bb){this.Vse=ka;this.sheetName=bb;this.ytc=!1}
function w(ka){var bb=da.call(this)||this;bb.$=ka;bb.dc();return bb}function B(ka,bb){var Ha=Zb.call(this)||this;Ha.Eqd=Q.a.Se;Ha.EXc=null;Ha.xhc=!1;Ha.yeb=!1;Ha.iqf=function(){var Ga=zb.g(Ha.$);Ga&&(Ga=Ga.sc(null))&&Ha.Ddb(Ga.cell.Gm,!0)};Ha.qDi=function(Ga){Ha.isActive()&&(na.a.Pq(Ga.Errors)||!Ga.Result?P.ULS.sendTraceTag(537155726,0,50,"GetCategoryFromServer failed, ignoring - server errors: {0}",Ga.Errors?Ga.Errors.join(","):"None"):(Ga=Ga.Result,P.ULS.sendTraceTag(537155725,0,50,"Updating number format category cache, format index = {0}, category = {1}",
Ga.Index,Ga.Category),Ha.Qjj(Ga.Index,Ga.Category),Ha.raiseEvent(B.GYc,new ba.a(Ga.Index,Ga.Category),Ha)))};Ha.refresh=function(){P.ULS.sendTraceTag(537155722,0,50,"InstantaneousSupportInformationManager.Refresh: start refresh");Ha.Z_b();if(Ha.isActive()&&Ha.fa.lc.allowEdits){if(Ha.yeb||Ha.hn&&!(Ha.fa.Jhc>Ha.Eqd))Ha.XAc();else{P.ULS.sendTraceTag(537155721,0,50,"InstantaneousSupportInformationManager.Refresh: getting instantaneous support information.");var Ga=Ha.$.qa.ta;var Ua=Ha.hn?Ha.hn.Digest:
"",jb=Ha.VDi,$a=Ha.UDi,Yb=Ga.Oa(1,null);Yb.previousResponseDigest=Ua;Ga=S.i(Ga,"GetInstantaneousSupportInformation",Yb,jb,$a,null,null,132);Ha.pdd=Ga}P.ULS.sendTraceTag(537155720,0,50,"InstantaneousSupportInformationManager.Refresh: getting functions info.");Ha.SWe()}};Ha.uuf=function(Ga){P.ULS.sendTraceTag(537155716,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListFailed failed, status = {0}, HTTP status = {1}.",Ga.data.status,Ga.data.httpStatus);Ha.EJa=null};Ha.gN=function(){Ha.yeb=
!1;Ha.fa.TC(Ha.gN);Ha.jQa(Ha.xhc?B.UNd:B.Svd)};Ha.Zc=function(Ga,Ua){P.ULS.sendTraceTag(537155715,0,50,"InstantaneousSupportInformationManager.OnSessionIdChanged called");ca.a(Ua)&&Ha.jQa(B.UNd)};Ha.Kf=function(){P.ULS.sendTraceTag(537155714,0,50,"InstantaneousSupportInformationManager.OnWorkbookMetadataChanged called");3!==Ha.$.workbookContext.CalcMode&&Ha.dwd(!Ha.$.workbookContext.CalcMode)};Ha.od=function(){P.ULS.sendTraceTag(537155713,0,50,"InstantaneousSupportInformationManager.OnWorkbookOpened called");
Ha.jQa(B.UNd);pa.EwaSettings.la(305)&&3!==Ha.$.workbookContext.CalcMode&&Ha.dwd(!Ha.$.workbookContext.CalcMode)};Ha.PDi=function(Ga,Ua,jb){P.ULS.sendTraceTag(537155712,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess called.");Ha.EJa=null;Ha.isActive()?Ga.StateId===Q.a.Se?(P.ULS.sendTraceTag(537155682,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: no session, waiting for session."),Ha.XAc()):!Ga.Result||Ha.xX&&Ha.xX.length?Ha.jQa(B.Svd):Ha.ayf(Ga,Ua,jb):
P.ULS.sendTraceTag(537155683,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: manager is inactive, skipping.")};Ha.ayf=function(Ga){Ha.xX=Ga.Result;P.ULS.sendTraceTag(537155681,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess refreshing functions info list, returned {0} functions.",Ha.xX?Ha.xX.length:-1);Ga=!1;if(Ha.xX){for(var Ua=yl(Ha.xX),jb=Ua.next();!jb.done;jb=Ua.next())if(jb=jb.value)Ha.ySe[jb.NameUI.toLocaleUpperCase()]=jb.FunctionIndex.toString(),
jb.NameUI!==jb.NameDataStrings&&(Ha.ySe[jb.NameDataStrings.toLocaleUpperCase()]=jb.FunctionIndex.toString(),Ga=!0),Ha.ozh.ia(jb.FunctionIndex,jb.NameUI);Ha.raiseEvent(B.yad,Sys.EventArgs.Empty,Ha)}Ga&&P.ULS.sendTraceTag(537155680,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess NameDataStrings functions names were used.")};Ha.VDi=function(Ga){if(Ha.isActive())if(P.ULS.shipAssertTag(537155679,0,!!Ha.$,"null ewaControl"),Ha.xhc=!1,Ha.Eqd=Ga.StateId,Ha.Eqd===Q.a.Se)Ha.xhc=!0,Ha.XAc();
else{if(Ga.Result){var Ua=Ha.hn;Ha.hn=Ga.Result;P.ULS.sendTraceTag(537155678,0,50,"InstantaneousSupportInformation updated, new result digest: {0}.",Ha.hn.Digest);Ga=[];if(Ua)Ga=B.wMh(Ua.NumberFormats,Ha.hn.NumberFormats);else for(Ua=0;Ua<Ha.hn.NumberFormats.length;Ua++)Ha.Bkc.ia(Ua,Ha.hn.NumberFormats[Ua].NumberFormatCategory);Ua=yl(Ga);for(var jb=Ua.next();!jb.done;jb=Ua.next())jb=jb.value,Ha.Bkc.ia(jb,Ha.hn.NumberFormats[jb].NumberFormatCategory);Ha.raiseEvent(B.xwd,new N(Ga),Ha);pa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.StructuredReferencesInRangePicker",
!1)&&Ha.raiseEvent(B.gif)}Ha.jQa(B.Svd)}};Ha.UDi=function(Ga){Ha.isActive()&&(10===Ga.data.status?P.ULS.sendTraceTag(537155677,0,50,"Instantaneous support information request cancelled."):(P.ULS.sendTraceTag(21311555,0,10,"Failed to update instantaneous support information, status = {0}, HTTP status = {1}.",Ga.data.status,Ga.data.httpStatus),Ha.xhc=!0,Ha.XAc()))};P.ULS.sendTraceTag(537155737,0,50,"InstantaneousSupportInformationManager ctor start");Ha.fa=ka;Ha.$=bb;Ha.zFb=null;Ha.pdd=null;Ha.EJa=
null;Ha.hn=null;Ha.Bkc=new Wb.a;Ha.Atb=new Wb.a;Ha.xX=[];Ha.ozh=new Wb.a;Ha.ySe={};Ha.fa.Sj(Ha.Zc);Ha.$.Rk(Ha.od);zb.g(Ha.$).ha.bra(Ha.iqf);pa.EwaSettings.la(305)&&Ha.fa.jt(Ha.Kf);Ha.jQa(B.W6e);P.ULS.sendTraceTag(537155736,0,50,"InstantaneousSupportInformationManager ctor end");return Ha}function U(ka){this.data=ka}function N(ka){var bb=Y.call(this)||this;bb.pSj=ka;return bb}b.r(D);y=b(10);D=b(0);var P=b(13),ia=b(216),W=b(88),R=b(5),I=b(185),Q=b(9),O=b(36),ba=b(1021),ca=b(219),S=b(81),Y=Sys.EventArgs;
vm(N,Y);Object(D.a)(N,"NumberFormatsUpdatedEventArgs",Sys.EventArgs,[]);var ma=b(44),Z=b(42),xa=b(32),na=b(27),pa=b(1),Ia=b(659),Ma=b(19),lb=b(273),zb=b(20),Ya=b(194);Object(D.a)(U,"NumberFormatDataHolder",null,[]);var Wb=b(122),Zb=O.a;vm(B,Zb);B.prototype.ile=function(ka){this.addHandler(B.xwd,ka)};B.prototype.YGd=function(ka){this.removeHandler(B.xwd,ka)};B.prototype.wzg=function(ka){this.addHandler(B.GYc,ka)};B.prototype.Q3i=function(ka){this.removeHandler(B.GYc,ka)};B.prototype.Pke=function(ka){this.addHandler(B.yad,
ka)};B.prototype.MGd=function(ka){this.removeHandler(B.yad,ka)};B.prototype.aBg=function(ka){this.addHandler(B.gif,ka)};B.prototype.Ddb=function(ka,bb){var Ha=this.Bkc.Ec(ka,0);var Ga=Ha.value;Ha=Ha.returnValue;!Ha&&0<ka&&this.$&&(P.ULS.sendTraceTag(537155735,0,50,"InstantaneousSupportInformationManager.TryGetNumberFormatCategory: failed to get category from numberFormatIndexToCategoryCache {0}",ka),this.xEh(ka),bb&&(Ga=this.wEh(ka),Ha=!0),Ia.a(ka,this.$.pI)&&(Ga=6));return{returnValue:Ha,category:Ga}};
B.prototype.Sai=function(ka){var bb=this.Ddb(ka,!0);var Ha=bb.category;if(bb.returnValue)return 6===Ha;P.ULS.sendTraceTag(537155733,0,50,"InstantaneousSupportInformationManager.IsFormatInPercentageCategory: failed to get category from format index {0}",ka);return!1};B.prototype.Nxh=function(ka){P.ULS.sendTraceTag(537155730,0,50,"InstantaneousSupportInformationManager.ForceRefreshFunctionInfo: Forcing refresh of functions");this.EJa=S.w(this.$.qa.ta,{FilterType:0},lb.b(this.ayf,ka),this.uuf,null,null,
null)};B.prototype.VRe=function(){this.jQa(B.W6e)};B.prototype.dwd=function(ka){this.EXc=ka};B.prototype.xEh=function(ka){if(this.Atb&&this.$){var bb=this.Atb.Ec(ka);var Ha=bb.value;if(!bb.returnValue||Ha.isCompleted){P.ULS.sendTraceTag(537155728,0,50,"Getting number format category for format index: {0}",ka);Ha=this.$.qa.ta;bb=this.qDi;var Ga=Ha.Oa(1,null);Ga.ifmt=ka;(Ha=S.i(Ha,"GetNumberFormatCategory",Ga,bb,null,null,null,4))&&this.Atb.ia(ka,Ha)}}else P.ULS.sendTraceTag(537155729,0,15,"GetCategoryFromServerAsync called on disposed InstantaneousSupportInformationManager instance, skipping")};
B.prototype.wEh=function(ka){return 1<=ka&&8>=ka?1:9<=ka&&12>=ka?2:13===ka||14===ka?6:15===ka?8:17===ka|18===ka?7:19===ka?4:16===ka||20<=ka&&29>=ka||31===ka?11:30===ka?9:32<=ka&&35>=ka?3:0};B.prototype.isActive=function(){var ka=void 0===this.fa||null===this.fa,bb=!ka&&this.fa.oc;P.ULS.sendTraceTag(537155727,0,50,"InstantaneousSupportInformationManager.IsActive: instantaneous support information manager active:{0} - sessionStateManager IsNullOrUndefined: {1}",bb,ka);return bb};B.prototype.Qjj=function(ka,
bb){this.Bkc.ia(ka,bb)};B.prototype.dispose=function(){W.a.Fa(this.zFb);this.zFb=null;this.Z_b();for(var ka=yl(this.Atb),bb=ka.next();!bb.done;bb=ka.next())(bb=bb.value.value)&&!bb.isCompleted&&R.AFrameworkApplication.Hd.Zt(bb.kt);this.Atb=null;this.fa&&(this.fa.kk(this.Zc),this.yeb&&this.fa.TC(this.gN),this.yeb=!1,this.fa.mw(this.Kf));this.fa=null;this.$&&zb.g(this.$)&&zb.g(this.$).ha&&(zb.g(this.$).ha.aza(this.iqf),this.$.ml(this.od));this.$=null;Zb.prototype.dispose.call(this)};B.prototype.isFeatureEnabled=
function(ka){try{switch(ka){case "LocaleLongDateFormat":return pa.EwaSettings.la(196);case "GetLocaleDayNames":return pa.EwaSettings.la(197);case "CalculateTextWidthIgnoreLetterSpacing":return pa.EwaSettings.la(286);case "OfficeVSO:3657744_CalcFixForDateFormat":return pa.EwaSettings.isChangeGateEnabled("OfficeVSO:3657744_CalcFixForDateFormat");case "OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero":return pa.EwaSettings.isChangeGateEnabled("OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero");
case "CalcAutocompleteExperiment":return pa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",!1);case "CalcNewFunctions":return pa.EwaSettings.la(247);case "CalcContractChecks":return pa.EwaSettings.la(248);case "CalcSupportDynamicArrays":return pa.EwaSettings.la(249);case "CalcFormatCalculations":return pa.EwaSettings.la(250);case "CalcFormulaCacheAPIChanges":return pa.EwaSettings.la(251);case "CalcStrictFormulaChecking":return pa.EwaSettings.la(252);
case "CalcSupportRowReference":return pa.EwaSettings.la(263);case "CalcParserUsesPledges":return pa.EwaSettings.la(310);case "CalcWebWorker":return!0;case "CalcWebWorkerTest":return pa.EwaSettings.la(309);case "CalcLookupFunctions":return pa.EwaSettings.la(311);case "CalcLogStopWatch":return pa.EwaSettings.la(379);case "CalcPreventSpillingHack":return pa.EwaSettings.la(253);case "CalcDynamicArrayOperators":return pa.EwaSettings.la(102);case "CalcDotOperator":return pa.EwaSettings.la(611);case "CalcLetFunction":return pa.EwaSettings.la(732);
default:return ka.startsWith("OfficeVSO:")?pa.EwaSettings.isChangeGateEnabled(ka):!1}}catch(bb){return P.ULS.sendTraceTag(537155724,0,15,"InstantaneousSupportInformation.IsFeatureEnabled({0}): feature parsing failed, returning false. Exception: {1}.",ka,bb.toString()),!1}};B.prototype.jQa=function(ka){this.isActive()&&this.fa.lc.allowEdits?(W.a.Fa(this.zFb),this.zFb=null,this.zFb=ma.a.instance.create(this.refresh,ka,Z.a.J6h)):P.ULS.sendTraceTag(537155723,0,50,"InstantaneousSupportInformationManager.ScheduleRefresh: won't schedule refresh. Edit permission: AllowEdits {0}, IsEditMode {1}",
void 0!==this.fa&&null!==this.fa&&void 0!==this.fa.lc&&null!==this.fa.lc?this.fa.lc.allowEdits:!1,void 0===this.fa||null===this.fa?!1:this.$.fa.isEditMode)};B.prototype.SWe=function(){P.ULS.sendTraceTag(537155719,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync called.");this.EJa?P.ULS.sendTraceTag(537155718,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync already running, skipping."):this.isActive()?this.xX&&this.xX.length||(this.EJa=S.w(this.$.qa.ta,{FilterType:0},
this.PDi,this.uuf,null,null,null)):P.ULS.sendTraceTag(537155717,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync session is not yet active, skipping.")};B.prototype.XAc=function(){this.yeb||(this.yeb=!0,this.fa.ED(this.gN))};B.prototype.Z_b=function(){this.Zt(this.pdd);this.Zt(this.EJa);this.EJa=this.pdd=null};B.prototype.Zt=function(ka){ka&&!ka.isCompleted&&this.$.qa.ta.Cdb(ka.kt)};B.wMh=function(ka,bb){if(!ka||!ka.length)return[];if(!bb||!bb.length){bb=Array(ka.length);for(var Ha=
0;Ha<ka.length;++Ha)bb[Ha]=ka[Ha].IfmtIndex;return bb}var Ga=new Wb.a;ka=yl(ka);for(Ha=ka.next();!Ha.done;Ha=ka.next())Ha=Ha.value,Ga.ia(Ha.IfmtIndex,new U(Ha));ka=new I.a;Ha={};bb=yl(bb);for(var Ua=bb.next();!Ua.done;Ha={Web:Ha.Web,VNb:Ha.VNb},Ua=bb.next())Ha.Web=Ua.value,Ha.VNb=void 0,function(jb){return function(){var $a=Ga.Ec(jb.Web.IfmtIndex);jb.VNb=$a.value;return $a}}(Ha)().returnValue&&Ha.VNb.data.FormatString===Ha.Web.FormatString||ka.add(Ha.Web.IfmtIndex);return ka.toArray()};tl.Object.defineProperties(B.prototype,
{He:{configurable:!0,enumerable:!0,get:function(){return this.hn?this.hn.LocaleInformation:null}},Jba:{configurable:!0,enumerable:!0,get:function(){return this.hn?this.hn.NumberFormats:[]}},Jia:{configurable:!0,enumerable:!0,get:function(){this.xX&&this.xX.length||this.SWe();return this.xX}},F6h:{configurable:!0,enumerable:!0,get:function(){return this.hn&&void 0!==this.hn.InstantaneousCalcWebWorkerPrecisionSamplingRate&&null!==this.hn.InstantaneousCalcWebWorkerPrecisionSamplingRate?this.hn.InstantaneousCalcWebWorkerPrecisionSamplingRate:
B.D8g}},I6h:{configurable:!0,enumerable:!0,get:function(){return this.hn&&void 0!==this.hn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate&&null!==this.hn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate?this.hn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate:B.H8g}},H6h:{configurable:!0,enumerable:!0,get:function(){return this.hn&&void 0!==this.hn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate&&null!==this.hn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate?this.hn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate:
B.G8g}},G6h:{configurable:!0,enumerable:!0,get:function(){return this.hn&&void 0!==this.hn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate&&null!==this.hn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate?this.hn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate:B.F8g}},G8e:{configurable:!0,enumerable:!0,get:function(){return this.hn?this.hn.InstantaneousCalcWebWorkerRenderingTimeLimitInMs:B.E8g}},kkd:{configurable:!0,enumerable:!0,get:function(){return null!==this.EXc?this.EXc:
this.hn?this.hn.InstantaneousCalcManualMode:!1}}});B.xwd="isim0";B.GYc="isim1";B.yad="isim2";B.gif="isim3";B.W6e=100;B.UNd=1E3;B.Svd=3E5;B.D8g=.001;B.H8g=.1;B.G8g=.2;B.F8g=.001;B.E8g=50;Object(D.a)(B,"InstantaneousSupportInformationManager",O.a,[220,3]);var da=ia.a;vm(w,da);w.prototype.create=function(){this.$&&(P.ULS.sendTraceTag(537155672,0,50,"InstantaneousSupportInformationManagerFactory.Create: Start loading script"),this.Fb(this.$.da.Aa(268)||new B(this.$.fa,this.$)))};w.ja=function(ka){if(!ka)throw Error.argumentNull("ewaControl");
ka.da.Ha(246,new w(ka))};Object(D.a)(w,"InstantaneousSupportInformationManagerFactory",ia.a,[]);var za=b(80),hb=b(110),Gb=b(84);Object(D.a)(G,"CalcBlockInformation",null,[]);Object(D.a)(r,"CalcNamedObject",null,[]);Object(D.a)(z,"GridCache",null,[]);var Sb=b(805),Fb=b(574);Object(D.a)(t,"SheetInformation",null,[]);var wa=b(1072),va;(function(ka){ka[ka.initialization=0]="initialization";ka[ka.contentReady=1]="contentReady";ka[ka.cellEdit=2]="cellEdit"})(va||(va={}));Object(D.b)("UpdateDataTrigger",
va);var sa=b(59);x.local="Local";x.pBj="Thread";Object(D.a)(x,"RecalcServiceCreateMode",null,[]);var sb=b(43),Tb=b(41),Da=b(153);A.prototype.init=function(ka){this.L0d=new Wb.a;if(void 0!==ka&&null!==ka&&void 0!==ka.HeadersList&&null!==ka.HeadersList&&0<ka.HeadersList.length){ka=yl(ka.HeadersList);for(var bb=ka.next();!bb.done;bb=ka.next())bb=bb.value,this.V9.ia(bb.Index,bb.Name)}};tl.Object.defineProperties(A.prototype,{V9:{configurable:!0,enumerable:!0,get:function(){return this.L0d}}});Object(D.a)(A,
"ColHeadersListData",null,[]);var Sa=b(95);b(193);var Ra=b(335);m.prototype.dispose=function(){this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.YGd(this.Owf);this.Nc&&this.Nc.ml(this.od);this.close()};m.prototype.Rdb=function(ka){if(!this.Nm)return!1;if(!this.instantaneousSupportInformationManager&&(this.instantaneousSupportInformationManager=this.Nc.da.Aa(268),!this.instantaneousSupportInformationManager))return P.ULS.sendTraceTag(537170198,0,50,"CalcAsyncEngine.UpdateData Failed to get instantaneousSupportInformationManager"),
!1;2!==ka&&(this.currentStateId=this.Nc.fa.Jhc,this.currentStateId===Q.a.Se&&(this.currentStateId=this.Nc.fa.rf));if(1===ka&&this.currentStateId<this.Kp)return P.ULS.sendTraceTag(537170197,0,50,"CalcAsyncEngine::UpdateData() currentStateId:{0} < lastUpdatedStateId:{1} - ignoring update",this.currentStateId,this.Kp),!1;this.Phj();ka&&this.xEd||(this.imj(),this.ljj(),this.Wjj(),this.setNumberFormats(),this.instantaneousSupportInformationManager.ile(this.Owf),this.Nc.Rk(this.od),this.xEd=!0);this.PZi();
var bb=!1;ka||(bb=this.x4h());if(ka||bb)this.tlj()?(this.Ylj(ka),this.Xlj(),this.Kp=this.currentStateId,this.kTg()):P.ULS.sendTraceTag(537170196,0,15,"CalcAsyncEngine::UpdateData() for StateId:{0} failed - no Sheets information",this.currentStateId);2!==ka&&this.resumeRecalc();return!0};m.prototype.evalFormula=function(ka){if(!this.Nm)return P.ULS.sendTraceTag(537170195,0,15,"CalcAsyncEngine.EvalFormula: recalc engine is null"),Promise.resolve({});ka=this.Nm.evalFormula(this.Nc.fa.rf,ka,sa.d(this.Nc.xa.oa));
this.resumeRecalc();return ka};m.prototype.evalFormulaRange=function(ka,bb,Ha){if(!this.Nm)return P.ULS.sendTraceTag(537170194,0,15,"CalcAsyncEngine.EvalFormulaRange: recalc engine is null"),Promise.reject(null);P.ULS.shipAssertTag(537170193,0,bb.isSingle,"CalcAsyncEngine.EvalFormulaRange: originCell Range must be a single cell.");Ha=sb.j(Ha);bb=sb.o(bb,this.Nc);bb=excelOnlineCalc.calc.cellLocation(bb.FirstRow,bb.FirstColumn);Ha=m.XT("EvalFormulaRange",sa.d(this.Nc.xa.oa),Ha.FirstRow,Ha.FirstColumn,
Ha.LastRow,Ha.LastColumn);P.ULS.sendTraceTag(537170190,0,50,"CalcAsyncEngine.EvalFormulaRange: calling calc.ts's EvalFormulaRange API for state ID {0}",this.Kp);ka=this.Nm.evalFormulaRange(this.Kp,ka,bb,Ha,null);ka.then(function(Ga){if(excelOnlineCalc.util.isSuccess(Ga)){var Ua=[];Ga=yl(Ga.value);for(var jb=Ga.next();!jb.done;jb=Ga.next())jb=jb.value,excelOnlineCalc.util.isSuccess(jb.value)||(jb=jb.value.reason.kind.toString(),Array.contains(Ua,jb)||Ua.push(jb));P.ULS.sendTraceTag(537170191,0,50,
"CalcAsyncEngine.EvalFormulaRange - Evaluation of range complete. FailureReasons: {0}",Ua.length?Sys.Serialization.JavaScriptSerializer.serialize(Ua):"None")}else P.ULS.sendTraceTag(537170192,0,15,"CalcAsyncEngine.EvalFormulaRange: Calc.EvalFormulaRange returned a failed object. failure reason: {0}",Ga.reason.kind)}).catch(function(Ga){P.ULS.sendTraceTag(537170189,0,10,"CalcAsyncEngine.EvalFormulaRange - promise rejected: {0}",Sys.Serialization.JavaScriptSerializer.serialize(Ga));return Promise.reject(Ga)});
this.resumeRecalc();return ka};m.prototype.$Og=function(ka,bb,Ha,Ga){Ga=void 0===Ga?null:Ga;if(this.Nm&&ka){var Ua=sa.d(this.Nc.xa.oa),jb=ka.cell.SJ-1,$a=ka.cell.RJ-1,Yb=jb,ec=$a,Za=null;Ga&&(Za=excelOnlineCalc.calc.cellLocation(jb,$a),jb=Ga.top-1,$a=Ga.left-1,Yb=Ga.bottom-1,ec=Ga.right-1);if(ka.cell.Eu)if(Ga=ka.cell.Eu.AWc,Ga===Q.a.Se)P.ULS.sendTraceTag(537170187,0,15,"CalcAsyncEngine::CalculateFormula() BlockRevision unknown for block:{0}",ka.cell.Eu.Xd);else if(Ga<this.Kp)P.ULS.sendTraceTag(537170185,
0,50,"CalcAsyncEngine::CalculateFormula() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < lastUpdatedStateId:{3}",jb,$a,Ga,this.Kp);else if(Ga<this.currentStateId)P.ULS.sendTraceTag(537170184,0,50,"CalcAsyncEngine::CalculateFormula() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < currentStateId:{3}",jb,$a,Ga,this.currentStateId);else if(this.RCb||(this.Nm.setOnRecalcResults(Ha),this.RCb=!0),this.N8f()&&!this.Rdb(2))P.ULS.sendTraceTag(537170183,0,15,"CalcAsyncEngine.CalculateFormula: UpdateData failed");
else{ec=m.XT("CalculateFormula.cell",Ua,jb,$a,Yb,ec);Ha=[];var Wa=zb.g(this.Nc);Yb=Wa.Ph;zb.g(this.Nc).$a.Zi&&(Yb=Wa.fg(1).Ph,Yb.Lma(1,1),Yb.Lma(3,1));Wa=null;Yb?Wa=m.XT("CalculateFormula.viewport",Ua,Yb.top-1,Yb.left-1,Yb.bottom-1,Yb.right-1):P.ULS.sendTraceTag(537170182,0,50,"CalcAsyncEngine::CalculateFormula() viewportRange is null, calc will use entire sheet...");bb=excelOnlineCalc.calc.inferredRangeFormulaEdit(ec,bb,Za,Wa);Array.add(Ha,bb);ka=Yb?String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",
Ua,jb,$a,Ma.a.LYb(ka.cell.text),Ga,Yb.top-1,Yb.left-1,Yb.bottom-1,Yb.right-1):String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",Ua,jb,$a,Ma.a.LYb(ka.cell.text),Ga,"","","","");P.ULS.sendTraceTag(537170181,0,50,ka);this.Nm.editRangeFormulas(Ga,Ha);this.resumeRecalc()}else P.ULS.sendTraceTag(537170186,0,15,"CalcAsyncEngine::CalculateFormula() GridBlockModelProxy is null cell:({0},{1})",ka.cell.SJ,ka.cell.RJ)}else P.ULS.sendTraceTag(537170188,
0,15,"CalcAsyncEngine::CalculateFormula() recalc engine is null:{0}, modifiedCell is null:{1}",!this.Nm,!ka)};m.prototype.YOg=function(ka,bb,Ha,Ga){Ga=void 0===Ga?null:Ga;var Ua=sa.d(this.Nc.xa.oa),jb=ka.cell.SJ-1,$a=ka.cell.RJ-1,Yb=jb,ec=$a,Za=null;Ga&&(Za=excelOnlineCalc.calc.cellLocation(jb,$a),jb=Ga.top-1,$a=Ga.left-1,Yb=Ga.bottom-1,ec=Ga.right-1);Ha=this.JWd(ka,Ha,"SetCell");0>Ha||(ec=m.XT("CalculateFormula.cell",Ua,jb,$a,Yb,ec),Yb=[],Ga=this.Nfd(Ua),bb=excelOnlineCalc.calc.inferredRangeFormulaEdit(ec,
bb,Za,Ga),Array.add(Yb,bb),ka=(bb=this.c1e())?String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",Ua,jb,$a,Ma.a.LYb(ka.cell.text),Ha,bb.top-1,bb.left-1,bb.bottom-1,bb.right-1):String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",Ua,jb,$a,Ma.a.LYb(ka.cell.text),Ha,"","","",""),P.ULS.sendTraceTag(537170180,0,50,ka),this.Nm.editRangeFormulas(Ha,
Yb),this.resumeRecalc())};m.prototype.Xrb=function(ka,bb,Ha,Ga){if(!this.Nm)return P.ULS.sendTraceTag(537170179,0,15,"CalcAsyncEngine::EvalFormulaRangeOnClone recalc engine is null"),Promise.reject("RecalcService is null");P.ULS.shipAssertTag(537170178,0,Ha.isSingle,"CalcAsyncEngine::EvalFormulaRangeOnClone originCell must be a single cell.");var Ua=sa.d(this.Nc.xa.oa),jb=this.Nfd(Ua),$a=null;if(ka){$a=[];ka=yl(ka);for(var Yb=ka.next();!Yb.done;Yb=ka.next())if(Yb=Yb.value,Yb.column!==Ha.left){var ec=
Yb.row-1;var Za=Yb.column-1;ec=m.XT("EvalFormulaRangeOnClone.cell",Ua,ec,Za,ec,Za);Za=Yb.text;Array.add($a,excelOnlineCalc.calc.rangeWrite(ec,excelOnlineCalc.calc.valueCellData(Za,Za,Yb.Gm,null)))}}Ha=excelOnlineCalc.calc.cellLocation(Ha.top-1,Ha.left-1);bb=m.XT("EvalFormulaRangeOnClone.outputColumnRange",Ua,bb.top-1,bb.left-1,bb.bottom-1,bb.right-1);Ga=[excelOnlineCalc.calc.cellFormulaRangeFormulaEdit(bb,Ga,Ha,jb)];$a=this.Nm.evalOnClonedModel($a,Ga);this.resumeRecalc();return $a};m.prototype.sCe=
function(ka){var bb=null;try{if(ka)if(this.Hsa=zb.g(this.Nc).Ca.rua(ka),this.currentStateId=ka.TRa,this.currentStateId<this.Kp||this.currentStateId===Q.a.Se)P.ULS.sendTraceTag(537170176,0,50,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() hash:{0} blockRevision:{1} < lastUpdatedStateId:{2}",this.Hsa,this.currentStateId,this.Kp);else{if(this.C4h(),!this.bKg()){var Ha=String.format("CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() Block Hash:{0} StateId:{1}",this.Hsa,this.currentStateId);
bb=this.Nc.Ub.Fc("ModelUpdate",Ha);this.vqb=this.Mub(ka.oa.sheetName);if(!this.vqb){var Ga=!!(this.Nc.Fd&32);P.ULS.sendTraceTag(537170147,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel SheetName not found. Number of existing sheets {0}, scratchPad:{1}, sheetNameLength:{2} Hash:{3}",this.Xe.wb(this.currentStateId)&&this.Xe.na(this.currentStateId).nj?this.Xe.na(this.currentStateId).nj.length:0,Ga,ka.oa.sheetName?ka.oa.sheetName.length:-1,ka.oa.hash)}else if(zb.g(this.Nc).Ca.Hl.u0a(ka.Xd)){var Ua=
ka.yf;if(Ua){var jb=Ua.getCalcBlockModel();if(!jb)P.ULS.sendTraceTag(537170145,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model for block");else if(this.UJg(jb)){this.Xe.na(this.currentStateId).jZa[this.Hsa]=new G(jb,ka.oa.sheetName);var $a=ka.re;$a?this.ixg($a.NamedObjects):P.ULS.sendTraceTag(537170144,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel GetGridBlockContentResponse is null")}}else P.ULS.sendTraceTag(537170146,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model accessor for block:{0}",
this.Hsa)}}}else P.ULS.shipAssertTag(537170177,0,!1,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() blockCacheItem is null")}finally{bb&&bb.stop()}};m.prototype.Sub=function(ka){if(!this.Xe.na(this.currentStateId).nj||!this.Xe.na(this.currentStateId).nj[0])return null;var bb=this.Xe.na(this.currentStateId).nj[0].v5;if(!bb||!bb.wb(ka.name))return null;bb=bb.na(ka.name);if(!bb||!bb.rG)return null;ka=new I.a;bb=yl(bb.rG.V9);for(var Ha=bb.next();!Ha.done;Ha=bb.next())ka.add(Ha.value.value);return ka};
m.prototype.getNameLoc=function(ka,bb){return this.zfc()?this.Xe.na(this.currentStateId).nj[0].v5.wb(bb)?(ka=excelOnlineCalc.location.nameLoc(ka,bb),excelOnlineCalc.util.success(ka)):excelOnlineCalc.util.success(null):(ka=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(ka))};m.prototype.getContainingTable=function(ka){if(!this.zfc())return ka=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(ka);var bb=ka.range.col,Ha=ka.range.row,Ga=this.Xe.na(this.currentStateId).nj[0].v5,
Ua=null;Ga=yl(Ga);for(var jb=Ga.next();!jb.done;jb=Ga.next())if(jb=jb.value.value,2===jb.type&&Ma.a.equals(ka.sheet.index.toString(),jb.sheetId,!0)){var $a=jb.range;bb>=$a.left-1&&bb<=$a.right-1&&Ha<=$a.bottom-1&&Ha>=$a.top-1&&(Ua=excelOnlineCalc.location.nameScope(this.documentLoc,jb.sheetId),Ua=excelOnlineCalc.location.nameLoc(Ua,jb.fullName))}return Ua?excelOnlineCalc.util.success(Ua):excelOnlineCalc.util.success(null)};m.prototype.getStructRefColumn=function(ka,bb){if(!this.zfc()){var Ha=excelOnlineCalc.util.unavailable([2]);
return excelOnlineCalc.util.failure(Ha)}Ha=ka.name;var Ga=this.Xe.na(this.currentStateId).nj[0].v5;if(Ga.wb(Ha)){Ga=Ga.na(Ha);var Ua=Ga.range;if(2!==Ga.type)return excelOnlineCalc.util.failure(this.p2c(5));var jb=Ga.rG?Ga.rG.V9:null;if(!jb)return excelOnlineCalc.util.success(null);for(var $a=yl(jb),Yb=$a.next();!Yb.done;Yb=$a.next())if(Yb=Yb.value,Ma.a.equals(Yb.value,bb,!0))return ka=excelOnlineCalc.location.documentLoc(ka.scope.document.path,ka.scope.document.name),ka=excelOnlineCalc.location.sheetIndex(ka,
Ga.sheetId),Ua=excelOnlineCalc.location.gridRange(Ua.top-1,Yb.key,Ua.bottom-Ua.top+1,1),Ua=excelOnlineCalc.location.sheetGridRange(ka,Ua),Ha=excelOnlineCalc.location.structRefColumnLoc(Ha,Ua,!!(Ga.attributes&16),!!(Ga.attributes&8)),excelOnlineCalc.util.success(Ha);return Ua.right-Ua.left+1!==jb.count?(Ha=excelOnlineCalc.util.unavailable([17,ka,bb]),excelOnlineCalc.util.failure(Ha)):excelOnlineCalc.util.failure(this.p2c(0))}return excelOnlineCalc.util.success(null)};m.prototype.getStructRefSpecialRef=
function(ka,bb){if(!this.zfc())return bb=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(bb);var Ha=this.Xe.na(this.currentStateId).nj[0].v5;if(Ha.wb(ka.name)){var Ga=Ha.na(ka.name);if(2!==Ga.type)return excelOnlineCalc.util.failure(this.p2c(5));Ha=!!(Ga.attributes&16);var Ua=!!(Ga.attributes&8),jb=Ha?1:0,$a=Ua?1:0;ka=excelOnlineCalc.location.documentLoc(ka.scope.document.path,ka.scope.document.name);ka=excelOnlineCalc.location.sheetIndex(ka,Ga.sheetId);Ga=Ga.range;var Yb={};if(1===
bb)Yb=excelOnlineCalc.location.gridRange(Ga.top-jb-1,Ga.left-1,Ga.bottom+$a-Ga.top+jb+1,Ga.right-Ga.left+1);else if(2===bb)Yb=excelOnlineCalc.location.gridRange(Ga.top-1,Ga.left-1,Ga.bottom-Ga.top+1,Ga.right-Ga.left+1);else if(3===bb)if(Ha)Yb=excelOnlineCalc.location.gridRange(Ga.top-2,Ga.left-1,1,Ga.right-Ga.left+1);else return excelOnlineCalc.util.success(null);else if(4===bb)if(Ua)Yb=excelOnlineCalc.location.gridRange(Ga.bottom,Ga.left-1,1,Ga.right-Ga.left+1);else return excelOnlineCalc.util.success(null);
bb=excelOnlineCalc.location.sheetGridRange(ka,Yb);return excelOnlineCalc.util.success(bb)}return excelOnlineCalc.util.success(null)};m.prototype.getDocumentLoc=function(ka,bb){if((Ma.a.equals(ka,this.documentLoc.path,!0)||!ka)&&Ma.a.equals(bb,this.documentLoc.name,!0))return excelOnlineCalc.util.success(this.documentLoc);ka=excelOnlineCalc.util.unavailable([0,excelOnlineCalc.location.documentLoc(ka,bb)]);return excelOnlineCalc.util.failure(ka)};m.prototype.getSheetIndex=function(ka,bb){if(!this.Xe.wb(this.currentStateId)||
!this.Xe.na(this.currentStateId).nj)return bb=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(bb);ka=this.Xe.na(this.currentStateId).nj;for(var Ha=1;Ha<ka.length;Ha++)if(Ma.a.equals(ka[Ha].Yma.sheetName,bb,!0))return excelOnlineCalc.util.success(ka[Ha].Yma.sheetId);return excelOnlineCalc.util.success(null)};m.prototype.getSheetName=function(ka,bb){if(!this.Xe.wb(this.currentStateId)||!this.Xe.na(this.currentStateId).nj)return bb=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(bb);
ka=this.Xe.na(this.currentStateId).nj;for(var Ha=1;Ha<ka.length;Ha++)if(Ma.a.equals(ka[Ha].Yma.sheetId,bb,!0))return excelOnlineCalc.util.success(ka[Ha].Yma.sheetName);return excelOnlineCalc.util.success(null)};m.prototype.getUserDefinedFuncLoc=function(){return excelOnlineCalc.util.notImplemented(["ParseGlobals.GetUserDefinedFuncLoc not implemented in main thread"])};m.prototype.getSheetRangeIndexes=function(){return excelOnlineCalc.util.notImplemented(["ParseGlobals.GetSheetRangeIndexes not implemented in main thread"])};
m.prototype.ZOg=function(ka,bb,Ha){var Ga=zb.g(this.Nc),Ua=Ga.sc(bb);Ua=this.JWd(Ua,null,"CopyPaste");Ha=this.JWd(Ga.sc(ka),Ha,"CopyPaste");if(0>Ua||0>Ha||Ua!==Ha)P.ULS.sendTraceTag(537170143,0,15,"CalcAsyncEngine::CalculateFormulaForCopyPaste(). Revision not valid. sourceRevision:{0}, targetRevision:{1}.",Ha,Ua);else{Ha=[];Ga=sa.d(this.Nc.xa.oa);var jb=this.Nfd(Ga);ka=m.XT("CalculateFormulaForCopyPaste.srcRange",Ga,ka.top-1,ka.left-1,ka.bottom-1,ka.right-1);bb=m.XT("CalculateFormulaForCopyPaste.targetRange",
Ga,bb.top-1,bb.left-1,bb.bottom-1,bb.right-1);bb=excelOnlineCalc.calc.copyPasteRangePasteEdit(bb,ka,jb);Array.add(Ha,bb);bb=jb?String.format("CalcAsyncEngine::CalculateFormulaForCopyPaste() for sheet:{0}, stateId:{1} viewport:(({2},{3})-({4},{5}))",Ga,Ua,jb.row,jb.column,jb.lastRow,jb.lastColumn):String.format("CalcAsyncEngine::CalculateFormulaForCopyPaste() for sheet:{0}, stateId:{1} viewport:(({2},{3})-({4},{5}))",Ga,Ua,"","","","");P.ULS.sendTraceTag(537170142,0,50,bb);this.Nm.editRangePaste(Ua,
Ha);this.resumeRecalc()}};m.prototype.Nfd=function(ka){var bb=this.c1e(),Ha=null;bb?Ha=m.XT("GetViewport.viewport",ka,bb.top-1,bb.left-1,bb.bottom-1,bb.right-1):P.ULS.sendTraceTag(537170141,0,50,"CalcAsyncEngine::GetViewport() viewportRange is null, calc will use entire sheet...");return Ha};m.prototype.c1e=function(){var ka=zb.g(this.Nc),bb=ka.Ph;if(zb.g(this.Nc).$a.Zi){bb=ka.fg(1).Ph;if(pa.EwaSettings.isChangeGateEnabled("OfficeVSO:5497152_JSCrash_At_CalcAsyncEngine_GetViewportRange")&&!bb)return P.ULS.sendTraceTag(537170140,
0,15,"CalcAsyncEngine::GetViewportRange viewportRange is null."),null;bb.Lma(1,1);bb.Lma(3,1)}return bb};m.prototype.JWd=function(ka,bb,Ha){if(!this.Nm||!ka)return P.ULS.sendTraceTag(537170139,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() recalc engine is null:{0}, modifiedCell is null:{1}, operation:{2}",!this.Nm,!ka,Ha),-1;var Ga=ka.cell.SJ-1,Ua=ka.cell.RJ-1;if(ka.cell.Eu){var jb=ka.cell.Eu.AWc;if(jb===Q.a.Se)return P.ULS.sendTraceTag(537170138,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() BlockRevision unknown for block:{0}, operation:{1}",
ka.cell.Eu.Xd,Ha),-1}else return P.ULS.sendTraceTag(537170137,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() GridBlockModelProxy is null cell:({0},{1}), operation:{2}",ka.cell.SJ,ka.cell.RJ,Ha),-1;if(jb<this.Kp)return P.ULS.sendTraceTag(537170136,0,50,"CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < lastUpdatedStateId:{3}, operation:{4}",Ga,Ua,jb,this.Kp,Ha),-1;if(jb<this.currentStateId)return P.ULS.sendTraceTag(537170135,0,50,"CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < currentStateId:{3}, operation:{4}",
Ga,Ua,jb,this.currentStateId,Ha),-1;bb&&!this.RCb&&(this.Nm.setOnRecalcResults(bb),this.RCb=!0);return this.N8f()&&!this.Rdb(2)?(P.ULS.sendTraceTag(537170134,0,15,"CalcAsyncEngine.ValidateCalculateFormulaInit: UpdateData failed. operation:{0}",Ha),-1):jb};m.prototype.getFormulaBarText=function(ka,bb,Ha){return bb&&bb.startsWith("'")?bb:ka.cell.formulaBarText||Ha.toString()};m.prototype.p4g=function(ka,bb,Ha){var Ga=null;if(this.zte()&&this.Xe.na(this.Kp).jZa){var Ua=this.Xe.na(this.Kp).jZa[ka];if(null===
Ua||void 0===Ua?0:Ua.ytc)Ga=Ua.Vse}Ha=this.e9h(Ga,bb,Ha);bb=this.JWg(Ga,bb,Ha);P.ULS.sendTraceTag(50671754,0,50,"CalcAsyncEngine::CreateRangeUpdateCommands() completed for Block Hash:{0} StateId:{1} number of formulas {2}",ka,this.currentStateId,bb)};m.prototype.e9h=function(ka,bb,Ha){var Ga=!1,Ua=m.vUe(bb);if(ka){var jb=m.vUe(ka);Ma.a.equals(jb,Ua,!1)&&(Ga=!0)}Ga?this.Kxg(ka,this.Kp,Ha):this.Mxg(bb,Ha);return Ga};m.prototype.zte=function(){var ka=!1;this.Nm&&-1!==this.Kp&&(ka=this.Nm.stateIdAvailable(this.Kp));
return ka&&this.Xe.wb(this.Kp)&&this.Kp<this.currentStateId};m.prototype.JWg=function(ka,bb,Ha){var Ga=0;var Ua,jb;for(bb.reset();Ua=bb.getNextCell();)Ya.e(Ua.formula)&&Ga++,(jb=Ha?ka.getCell(Ua.row,Ua.col):null)?this.FWg(bb,Ua,jb):this.Lxg(bb,Ua);if(Ha)for(ka.reset();jb=ka.getNextCell();)(Ua=bb.getCell(jb.row,jb.col))||this.Ije(ka,jb);return Ga};m.prototype.Wjj=function(){this.Nm.setOnUpdateRequest(function(){})};m.prototype.Vjj=function(){var ka=this;this.Nm.setOnUnresponsive(function(bb,Ha,Ga,
Ua){ka.$Li(bb,Ha,Ga,Ua)})};m.prototype.$Li=function(ka,bb,Ha,Ga){P.ULS.sendTraceTag(537170126,0,15,"CalcAsyncEngine.onUnresponsive: worker thread was unresponsive. timeout:{0}, waitTime:{1}, timeoutCount:{2}, hasBeenClosed:{3}.",ka,bb,Ha,Ga);Ga&&(this.Y9i(),this.Nna())};m.prototype.Y9i=function(){this.od(null,null);this.Krd=this.RCb=!1;this.ACd=0;this.sCd=this.uCd=this.vCd=this.tCd=-1};m.prototype.close=function(){this.Nm.close()};m.prototype.clearCache=function(){this.Nm.clearCache()};m.prototype.resumeRecalc=
function(){this.Nm.resumeRecalc()};m.prototype.ljj=function(){this.Nm.setA1ReferenceStyle(!0)};m.prototype.PZi=function(){if(this.instantaneousSupportInformationManager){var ka=this.instantaneousSupportInformationManager.F6h,bb=this.instantaneousSupportInformationManager.I6h,Ha=this.instantaneousSupportInformationManager.H6h,Ga=this.instantaneousSupportInformationManager.G6h,Ua=!1;ka!==this.tCd&&(Ua=!0,this.tCd=ka);bb!==this.vCd&&(Ua=!0,this.vCd=bb);Ha!==this.uCd&&(Ua=!0,this.uCd=Ha);Ga!==this.sCd&&
(Ua=!0,this.sCd=Ga);var jb=[];pa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSExceLintExperimentIsEnabled",!1)&&(Ua=excelOnlineCalc.calc.runExperiment("ExceLintExperiment",null),jb.push(Ua),Ua=!0);pa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.UnitExperiment",!1)&&(Ua=excelOnlineCalc.calc.runExperiment("UnitExperiment",null),jb.push(Ua),Ua=!0);pa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",!1)&&(Ua=excelOnlineCalc.calc.runExperiment("AutocompleteExperiment",
null),jb.push(Ua),Ua=!0);Ua&&(ka=excelOnlineCalc.calc.recalcServiceConfig(null,ka,null,bb,null,null,null,Ha,jb,Ga),this.Nm.reconfigure(ka))}};m.prototype.Ylj=function(ka){var bb=this,Ha=null;if(this.Xe.wb(this.currentStateId))try{this.p$=[];var Ga=String.format("CalcAsyncEngine::SetUpdatedRanges() StateId:{0} UpdateTriggerData:{1}",this.currentStateId,va[ka]);Ha=this.Nc.Ub.Fc("ModelUpdate",Ga);hb.a.forEach(this.Xe.na(this.currentStateId).jZa,function(Ua,jb){jb.ytc||(bb.p4g(Ua,jb.Vse,jb.sheetName),
jb.ytc=!0)},null);this.Nm.updateRanges(this.currentStateId,this.p$)}finally{Ha&&Ha.stop()}else P.ULS.sendTraceTag(537170122,0,15,"CalcAsyncEngine::SetUpdatedRanges StateId:{0} does not exist in GridCache",this.currentStateId)};m.prototype.Xlj=function(){var ka=[],bb=this.zte(),Ha=bb&&this.Xe.na(this.Kp).nj&&this.Xe.na(this.Kp).nj[0]&&this.Xe.na(this.Kp).nj[0].ckc?this.Xe.na(this.Kp).nj[0].v5:null;this.mye(Ha,this.Xe.na(this.currentStateId).nj[0].v5,null,this.Kp,ka);this.Xe.na(this.currentStateId).nj[0].ckc=
!0;for(var Ga=1;Ga<this.Xe.na(this.currentStateId).nj.length;Ga++)Ha=-1,bb&&this.Xe.na(this.Kp).nj&&(Ha=this.Ved(this.Xe.na(this.currentStateId).nj[Ga].Yma.sheetName,this.Kp)),Ha=-1!==Ha&&this.Xe.na(this.Kp).nj[Ha].ckc?this.Xe.na(this.Kp).nj[Ha].v5:null,this.mye(Ha,this.Xe.na(this.currentStateId).nj[Ga].v5,this.Xe.na(this.currentStateId).nj[Ga].Yma.sheetId,this.Kp,ka),this.Xe.na(this.currentStateId).nj[Ga].ckc=!0;this.Nm.updateNamedObjects(this.currentStateId,ka)};m.prototype.mye=function(ka,bb,Ha,
Ga,Ua){if(void 0!==Ha&&null!==Ha){var jb=excelOnlineCalc.calc.undefinedNamesWrite(Ha);Array.add(Ua,jb)}if(ka){var $a=!1,Yb=[];jb=[];if(bb)for(var ec=yl(bb),Za=ec.next();!Za.done;Za=ec.next()){Za=Za.value;var Wa=Za.value;if(ka.wb(Za.key)){var Ca=ka.na(Za.key);m.Cvi(Ca,Wa)?$a=!0:(Ca=excelOnlineCalc.calc.namedObject(Za.key,null),Array.add(Yb,Ca),m.zSc(Za.key,Wa,jb))}else m.zSc(Za.key,Wa,jb)}ka=yl(ka);for(Za=ka.next();!Za.done;Za=ka.next())ec=Za.value,bb&&bb.wb(ec.key)||(ec=excelOnlineCalc.calc.namedObject(ec.key,
null),Array.add(Yb,ec));$a&&(bb=excelOnlineCalc.calc.namedObjectsPromote(Ha,Ga),Array.add(Ua,bb));0<Yb.length&&(bb=excelOnlineCalc.calc.namedObjectsWrite(Ha,Yb),Array.add(Ua,bb));0<jb.length&&(Ha=excelOnlineCalc.calc.namedObjectsWrite(Ha,jb),Array.add(Ua,Ha))}else if(bb){jb=[];bb=yl(bb);for(Ga=bb.next();!Ga.done;Ga=bb.next())Ga=Ga.value,m.zSc(Ga.key,Ga.value,jb);0<jb.length&&(Ha=excelOnlineCalc.calc.namedObjectsWrite(Ha,jb),Array.add(Ua,Ha))}};m.prototype.bKg=function(){return this.Xe.na(this.currentStateId).jZa[this.Hsa]?
(P.ULS.sendTraceTag(537170121,0,50,"CalcAsyncEngine::BlockPreviouslyHandled Block Hash:{0} StateId:{1} previously handled",this.Hsa,this.currentStateId),!0):!1};m.prototype.UJg=function(ka){return 1===ka.getColumnNumbers().length&&ka.getColumnNumbers()[0]===m.Otd+1?!1:!0};m.prototype.x4h=function(){var ka=this,bb=!1;zb.g(this.Nc).Ca.Q$c(function(Ha){Ha.state&1&&ka.Nc.fa.rf===Ha.ie.Revision&&(ka.sCe(Ha),bb=!0)});return bb};m.prototype.xAe=function(ka,bb){var Ha=ka.getRowNumbers(),Ga=ka.getColumnNumbers();
ka=Ha[0]-1;Ha=Ha[Ha.length-1]-1;var Ua=Ga[0]-1;Ga=Ga[Ga.length-1]-1;(bb=this.Mub(bb))||P.ULS.sendTraceTag(537170120,0,15,"CalcAsyncEngine::CreateBlockRangeLocation SheetName not found. Number of existing sheets {0}",this.Xe.wb(this.currentStateId)&&this.Xe.na(this.currentStateId).nj?this.Xe.na(this.currentStateId).nj.length:0);return m.XT("CreateBlockRangeLocation",bb,ka,Ua,Ha,Ga)};m.prototype.Kxg=function(ka,bb,Ha){if(Ha=this.xAe(ka,Ha)){var Ga=m.O2b(ka.getRowNumbers());ka=m.O2b(ka.getColumnNumbers());
bb=excelOnlineCalc.calc.rangePromote(Ha,bb,Ga,ka);this.p$[this.p$.length]=bb}};m.prototype.Mxg=function(ka,bb){if(bb=this.xAe(ka,bb)){var Ha=m.O2b(ka.getRowNumbers());ka=m.O2b(ka.getColumnNumbers());ka=excelOnlineCalc.calc.rangeWrite(bb,null,Ha,ka);this.p$[this.p$.length]=ka}};m.prototype.FWg=function(ka,bb,Ha){var Ga=null,Ua=0,jb=0;switch(bb.valueType){case 2:Ga=this.Lfd(bb);var $a=this.Lfd(Ha);$a=Ma.a.equals($a,Ga,!1);break;case 1:null===bb.value&&null===Ha.value?$a=!0:(Ua=parseFloat(bb.value),
$a=parseFloat(Ha.value)===Ua);break;default:null===bb.value&&null===Ha.value?$a=!0:(jb=parseFloat(bb.value),$a=jb===parseFloat(Ha.value))}$a&&bb.valueType===Ha.valueType&&bb.ifmt===Ha.ifmt&&bb.formulaType===Ha.formulaType&&Ma.a.equals(Ha.formula,bb.formula,!1)||(void 0!==bb.formula&&null!==bb.formula||void 0!==bb.value&&null!==bb.value||void 0!==bb.text&&null!==bb.text?this.rXb(ka,bb,Ga,Ua,jb):this.Ije(ka,bb))};m.prototype.ixg=function(ka){if(this.Nc.xb&&this.Nc.xb.items)for(var bb=0;bb<this.Nc.xb.count;bb++){var Ha=
this.Nc.xb.items[bb];if(2===Ha.type||3===Ha.type){var Ga=0,Ua=Ha.name,jb=Ua.lastIndexOf("!");if(0<jb){Ga=Ua.substr(0,jb);"'"===Ga.charAt(0)&&(Ga=Ga.substr(1,Ga.length-2));Ga=this.Ved(Ga,this.currentStateId);if(-1===Ga){P.ULS.sendTraceTag(595096334,0,15,"CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets {0}",this.Xe.wb(this.currentStateId)&&this.Xe.na(this.currentStateId).nj?this.Xe.na(this.currentStateId).nj.length:0);continue}Ua=Ua.substr(jb+1)}Ga=this.Xe.na(this.currentStateId).nj[Ga].v5;
var $a=Ha.usedRange;2===Ha.type&&($a=Da.a(Ha));if(Ga.wb(Ua)){if(jb=Ga.na(Ua),pa.EwaSettings.isChangeGateEnabled("OfficeVSO:5502630_AddNamedObjectsInBlock_updateRange")&&(jb.range=$a,jb.attributes=Ha.attributes),2===jb.type&&(Ua=m.yQe(Ha.name,ka)))if(!jb.rG)jb.rG=new A(Ua.ColHeadersList);else if(Ua.ColHeadersList)for(Ua=yl(Ua.ColHeadersList.HeadersList),Ha=Ua.next();!Ha.done;Ha=Ua.next())Ha=Ha.value,jb.rG.V9.ia(Ha.Index,Ha.Name)}else(jb=this.Mub(Ha.sheetName))?(jb=new r(Ha.type,Ha.name,$a,jb,Ha.attributes),
2===jb.type&&(Ha=m.yQe(Ha.name,ka))&&(jb.rG=new A(Ha.ColHeadersList)),Ga.ia(Ua,jb)):P.ULS.sendTraceTag(537170117,0,50,"CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets {0}",this.Xe.wb(this.currentStateId)&&this.Xe.na(this.currentStateId).nj?this.Xe.na(this.currentStateId).nj.length:0)}}};m.prototype.rXb=function(ka,bb,Ha,Ga,Ua){var jb=ka.getRowNumbers()[bb.row]-1;ka=ka.getColumnNumbers()[bb.col]-1;jb=m.XT("AddRangeUpdateCommand",this.vqb,jb,ka,jb,ka);ka=null;
var $a=bb.formula||bb.text,Yb=excelOnlineCalc.calc.blankValue,ec=null;void 0!==bb.text&&null!==bb.text||void 0!==bb.value&&null!==bb.value||(Ha="",ec="This cell contains blanks only",bb.formulaType||($a=""));switch(bb.valueType){case 2:null!==Ha&&(bb.formulaType||(ka=excelOnlineCalc.calc.valueCellData($a,Ha,bb.ifmt,ec)),1===bb.formulaType&&(ka=excelOnlineCalc.calc.cellFormulaCellData($a,Ha,bb.ifmt,ec)),2===bb.formulaType&&(ka=excelOnlineCalc.calc.valueCellData("",Yb,0,"This cell is a part of an array")));
break;case 1:isNaN(Ga)?P.ULS.sendTraceTag(537170116,0,50,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid numeric value",bb.row,bb.col):(bb.formulaType||(ka=excelOnlineCalc.calc.valueCellData($a,Ga,bb.ifmt,null)),1===bb.formulaType&&(ka=excelOnlineCalc.calc.cellFormulaCellData($a,Ga,bb.ifmt,null)),2===bb.formulaType&&(ka=excelOnlineCalc.calc.valueCellData("",Yb,0,"This cell is a part of an array")));break;case 3:isNaN(Ua)?P.ULS.sendTraceTag(537170115,0,15,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid boolean value",
bb.row,bb.col):(Ha=1===Ua?!0:!1,bb.formulaType||(ka=excelOnlineCalc.calc.valueCellData($a,Ha,bb.ifmt,null)),1===bb.formulaType&&(ka=excelOnlineCalc.calc.cellFormulaCellData($a,Ha,bb.ifmt,null)),2===bb.formulaType&&(ka=excelOnlineCalc.calc.valueCellData("",Yb,0,"This cell is a part of an array")));break;case 4:isNaN(Ua)?P.ULS.sendTraceTag(537170114,0,15,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid error value",bb.row,bb.col):(Ha=excelOnlineCalc.calc.errorValue(Ua),bb.formulaType||
(ka=excelOnlineCalc.calc.valueCellData($a,Ha,bb.ifmt,null)),1===bb.formulaType&&(ka=excelOnlineCalc.calc.cellFormulaCellData($a,Ha,bb.ifmt,null)),2===bb.formulaType&&(ka=excelOnlineCalc.calc.valueCellData("",Yb,0,"This cell is a part of an array")));break;default:ka=excelOnlineCalc.calc.valueCellData("",Yb,bb.ifmt,null)}ka&&(bb=excelOnlineCalc.calc.rangeWrite(jb,ka,null,null),this.p$[this.p$.length]=bb)};m.prototype.Lxg=function(ka,bb){switch(bb.valueType){case 2:this.rXb(ka,bb,this.Lfd(bb),null,
0);break;case 1:this.rXb(ka,bb,null,parseFloat(bb.value),0);break;default:this.rXb(ka,bb,null,null,parseFloat(bb.value))}};m.prototype.Ije=function(ka,bb){var Ha=ka.getRowNumbers()[bb.row]-1;ka=ka.getColumnNumbers()[bb.col]-1;Ha=m.XT("AddRangeUpdateCommandEmptyCell",this.vqb,Ha,ka,Ha,ka);bb=excelOnlineCalc.calc.valueCellData("",excelOnlineCalc.calc.blankValue,bb.ifmt,null);bb=excelOnlineCalc.calc.rangeWrite(Ha,bb,null,null);this.p$[this.p$.length]=bb};m.prototype.Mub=function(ka){ka=this.Ved(ka,this.currentStateId);
return 0<ka?this.Xe.na(this.currentStateId).nj[ka].Yma.sheetId:null};m.prototype.Ved=function(ka,bb){if(!this.Xe.wb(bb))return P.ULS.sendTraceTag(537170113,0,15,"CalcAsyncEngine.GetSheetInternalIndex StateId:{0} does not exist in GridCache",bb),-1;if(!this.Xe.na(bb).nj)return P.ULS.sendTraceTag(537170112,0,15,"CalcAsyncEngine.GetSheetInternalIndex sheetsInformation == null for StateId:{0}",bb),-1;bb=this.Xe.na(bb).nj;for(var Ha=1;Ha<bb.length;Ha++)if(Ma.a.equals(bb[Ha].Yma.sheetName,ka,!1))return Ha;
return-1};m.prototype.tlj=function(){if(!this.Xe.wb(this.currentStateId)||!this.Xe.na(this.currentStateId).nj.length)return P.ULS.sendTraceTag(537170083,0,15,"CalcAsyncEngine::SetSheetNamesAndUsedRanges() No sheets information for StateId:{0} or StateId does not exist in GridCache",this.currentStateId),!1;for(var ka=[],bb=1;bb<this.Xe.na(this.currentStateId).nj.length;bb++){var Ha=this.Xe.na(this.currentStateId).nj[bb];Ha&&Array.add(ka,Ha.Yma)}this.Nm.updateSheetNames(this.currentStateId,ka);this.Nm.updateUnusedCells(this.currentStateId,
this.Xe.na(this.currentStateId).a9f);return!0};m.prototype.setNumberFormats=function(){if(this.instantaneousSupportInformationManager){for(var ka=[],bb=yl(this.instantaneousSupportInformationManager.Jba),Ha=bb.next();!Ha.done;Ha=bb.next())Ha=Ha.value,Ha=excelOnlineCalc.calc.numberFormat(Ha.IfmtIndex,Ha.FormatString,Ha.Builtin),Array.add(ka,Ha);this.Nm.setNumberFormats(ka,!0)}};m.prototype.Phj=function(){if(this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.He){var ka=
this.A4h();if(!this.Krd||ka)this.N2b(),this.instantaneousSupportInformationManager.He.TrueValueString&&(this.trueName=this.instantaneousSupportInformationManager.He.TrueValueString),this.instantaneousSupportInformationManager.He.FalseValueString&&(this.falseName=this.instantaneousSupportInformationManager.He.FalseValueString),ka=wa.CalcHelper.mBe(this.instantaneousSupportInformationManager,ka),this.Nm.setLocale(ka),this.Krd=!0}};m.prototype.imj=function(){var ka=null;if(void 0!==this.Nc.workbookContext.TimeZoneInformation&&
null!==this.Nc.workbookContext.TimeZoneInformation){ka=null;this.Nc.workbookContext.TimeZoneInformation.StandardDate.Month&&(ka=excelOnlineCalc.date.dateTime(this.Nc.workbookContext.TimeZoneInformation.StandardDate.Year,this.Nc.workbookContext.TimeZoneInformation.StandardDate.Month,this.Nc.workbookContext.TimeZoneInformation.StandardDate.Day,this.Nc.workbookContext.TimeZoneInformation.StandardDate.Hour,this.Nc.workbookContext.TimeZoneInformation.StandardDate.Minute,this.Nc.workbookContext.TimeZoneInformation.StandardDate.Second,
this.Nc.workbookContext.TimeZoneInformation.StandardDate.DayOfWeek+1,this.Nc.workbookContext.TimeZoneInformation.StandardDate.Milliseconds,3));var bb=null;this.Nc.workbookContext.TimeZoneInformation.DaylightDate.Month&&(bb=excelOnlineCalc.date.dateTime(this.Nc.workbookContext.TimeZoneInformation.DaylightDate.Year,this.Nc.workbookContext.TimeZoneInformation.DaylightDate.Month,this.Nc.workbookContext.TimeZoneInformation.DaylightDate.Day,this.Nc.workbookContext.TimeZoneInformation.DaylightDate.Hour,
this.Nc.workbookContext.TimeZoneInformation.DaylightDate.Minute,this.Nc.workbookContext.TimeZoneInformation.DaylightDate.Second,this.Nc.workbookContext.TimeZoneInformation.DaylightDate.DayOfWeek+1,this.Nc.workbookContext.TimeZoneInformation.DaylightDate.Milliseconds,3));ka=excelOnlineCalc.date.tzData(this.Nc.workbookContext.TimeZoneInformation.Bias,ka,this.Nc.workbookContext.TimeZoneInformation.StandardBias,bb,this.Nc.workbookContext.TimeZoneInformation.DaylightBias)}else P.ULS.sendTraceTag(537170082,
0,15,"CalcAsyncEngine.SetWorkbookProperties: TimeZoneInformation is null");ka=excelOnlineCalc.calc.workbookProps(this.Nc.workbookContext.F1904,this.Nc.workbookContext.FDateCompatibility,ka);this.Nm.setWorkbookProps(ka)};m.prototype.Nna=function(){var ka=this;pa.EwaSettings.la(309)&&Ra.c(excelOnlineCalc.worker.runSmokeTest(1/0,this.k1f,!0)).continueWith(function(Ha){Ha.mg?P.ULS.sendTraceTag(537170079,0,15,"CalcAsyncEngine.TryInitialize: calc smoke test failed: {0}",Ha.mg.toString()):P.ULS.sendTraceTag(537170080,
0,50,"CalcAsyncEngine.TryInitialize: calc smoke test ended - a new one should start")});var bb=pa.EwaSettings.la(684)?x.local:x.pBj;this.yEd=Ra.c(excelOnlineCalc.calc.createRecalcService(bb,Tb.a.bka()));this.yEd.continueWith(function(Ha){Ha.mg?P.ULS.sendTraceTag(537170075,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker failed: {0}",Ha.mg.toString()):(P.ULS.sendTraceTag(537170078,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker is working as expected"),ka.Nm=ka.yEd.result,ka.Nm?ka.Rdb(0)?
ka.Vjj():P.ULS.sendTraceTag(537170077,0,15,"CalcAsyncEngine.TryInitialize: UpdateData failed to initialize"):P.ULS.sendTraceTag(537170076,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker result is null"))})};m.prototype.A4h=function(){var ka=this.instantaneousSupportInformationManager.Jia;if(!ka||this.ACd===ka.length)return null;this.ACd=ka.length;return wa.CalcHelper.aBe(ka)};m.prototype.N2b=function(){this.errorTypeNames=wa.CalcHelper.N2b()};m.prototype.C4h=function(){if(!(this.Xe.wb(this.currentStateId)&&
0<this.Xe.na(this.currentStateId).nj.length)){this.Xe.ia(this.currentStateId,new z);this.Xe.na(this.currentStateId).nj[0]=new t(null);for(var ka=this.Nc.xa,bb=0;bb<ka.count;bb++){var Ha=Object(Gb.a)(Sa.a,ka.getItem(bb));if(Ha){void 0!==Ha.sheetId&&null!==Ha.sheetId&&void 0!==Ha.name&&null!==Ha.name&&Ha.sheetId.length&&Ha.sheetName.length||P.ULS.sendTraceTag(537170074,0,15,"CalcAsyncEngine::InitializeGridForStateId() invalid sheet - index:{0} Id:{1} Hash:{2} NameLength:{3}",bb,Ha.sheetId,Ha.hash,Ha.name?
Ha.name.length:-1);var Ga=excelOnlineCalc.calc.sheetName(Ha.sheetId,Ha.name);this.Xe.na(this.currentStateId).nj[bb+1]=new t(Ga);Ga=Ha.usedRange.PW();Ga=excelOnlineCalc.calc.rangeLocation(0,0,Ga.LastRow,Ga.LastColumn);Ha=excelOnlineCalc.calc.unusedCellsUpdate(Ha.sheetId,Ga);Array.add(this.Xe.na(this.currentStateId).a9f,Ha)}else P.ULS.sendTraceTag(537170073,0,15,"CalcAsyncEngine.InitializeGridForStateId(): not sheet item for StateId:{0} sheet-index:{1}",this.currentStateId,bb)}}};m.prototype.kTg=function(){for(var ka=
yl(this.Xe),bb=ka.next();!bb.done;bb=ka.next())bb=bb.value,bb.key<this.Kp&&this.Xe.remove(bb.key)};m.prototype.Lfd=function(ka){ka=ka.value||ka.text;if(void 0===ka||null===ka)ka="";return ka};m.prototype.N8f=function(){if(!this.Xe.wb(this.currentStateId))return!1;var ka=!1;hb.a.forEach(this.Xe.na(this.currentStateId).jZa,function(bb,Ha){Ha.ytc||(ka=!0)},null);return ka};m.prototype.p2c=function(ka){var bb={};bb.reason=ka;bb.kind=1;return bb};m.prototype.zfc=function(){return this.Xe.wb(this.currentStateId)&&
this.Xe.na(this.currentStateId).nj&&this.Xe.na(this.currentStateId).nj[0]&&this.Xe.na(this.currentStateId).nj[0].v5?!0:!1};m.t0g=function(ka){var bb=[];if(null===ka||void 0===ka?0:ka.V9){ka=yl(ka.V9);for(var Ha=ka.next();!Ha.done;Ha=ka.next())Ha=Ha.value,Ha=excelOnlineCalc.calc.columnData(Ha.key,Ha.value),Array.add(bb,Ha)}return bb};m.Cvi=function(ka,bb){if(ka.type!==bb.type||ka.attributes!==bb.attributes||!Ma.a.equals(ka.fullName,bb.fullName,!1)||!ka.range.equals(bb.range))return!1;if(!ka.rG&&!bb.rG)return!0;
if(!ka.rG||!bb.rG||ka.rG.V9.count!==bb.rG.V9.count)return!1;var Ha={};ka=yl(ka.rG.V9);for(var Ga=ka.next();!Ga.done;Ha={Yeb:Ha.Yeb,efb:Ha.efb},Ga=ka.next())if(Ha.Yeb=Ga.value,Ha.efb=void 0,!(Ha.Yeb.value&&function(Ua){return function(){var jb=bb.rG.V9.Ec(Ua.Yeb.key);Ua.efb=jb.value;return jb}}(Ha)().returnValue&&Ha.efb&&Ma.a.equals(Ha.Yeb.value,Ha.efb,!1)))return!1;return!0};m.zSc=function(ka,bb,Ha){var Ga=m.XT("NamedObject",bb.sheetId,bb.range.top-1,bb.range.left-1,bb.range.bottom-1,bb.range.right-
1);if(2===bb.type){var Ua=!!(bb.attributes&16),jb=!!(bb.attributes&8);bb=m.t0g(bb.rG);Ga=excelOnlineCalc.calc.namedTableData(Ga,Ua,jb,bb);ka=excelOnlineCalc.calc.namedObject(ka,Ga)}else Ga=excelOnlineCalc.calc.namedRangeData(Ga),ka=excelOnlineCalc.calc.namedObject(ka,Ga);Array.add(Ha,ka)};m.vUe=function(ka){var bb=Sys.Serialization.JavaScriptSerializer.serialize(ka.getRowNumbers());ka=Sys.Serialization.JavaScriptSerializer.serialize(ka.getColumnNumbers());return bb+ka};m.O2b=function(ka){var bb=null;
if(1<ka.length)for(var Ha=1;Ha<ka.length;Ha++)for(var Ga=0;ka[Ha-1]+1+Ga<ka[Ha];)bb=bb||[],Array.add(bb,ka[Ha-1]+Ga),Ga++;return bb};m.yQe=function(ka,bb){if(!bb)return null;for(var Ha=0,Ga=bb.length;Ha<Ga;++Ha)if(Ma.a.equals(ka,bb[Ha].Name,!1))return bb[Ha];return null};m.XT=function(ka,bb,Ha,Ga,Ua,jb){function $a(Yb,ec,Za,Wa){(0>Za||Za>=Wa)&&P.ULS.sendTraceTag(537170072,0,15,"CalcAsyncEngine::CreateSheetRangeLocation() callerId:{0} invalid {1}:{2}",Yb,ec,Za)}void 0!==bb&&null!==bb||P.ULS.sendTraceTag(537170071,
0,15,"CalcAsyncEngine::CreateSheetRangeLocation() callerId:{0} sheetId is null",ka);$a(ka,"top",Ha,m.Vlf);$a(ka,"left",Ga,m.Otd);$a(ka,"bottom",Ua,m.Vlf);$a(ka,"right",jb,m.Otd);return excelOnlineCalc.calc.sheetRangeLocation(bb,Ha,Ga,Ua,jb)};m.Vlf=1048576;m.Otd=16384;Object(D.a)(m,"CalcAsyncEngine",null,[3]);Object(D.a)(v,"AbsoluteRelativeReferenceInfo",null,[]);var Lb=b(1132),Ja=b(24);u.oEf="#";Object(D.a)(u,"Operators",null,[]);var wb=b(1133);f.sheet="Sheet";f.sheetRange="SheetRange";f.document=
"Document";f.r1h="Ident";Object(D.a)(f,"TraverseFormulaQualifierTypes",null,[]);var Mb=b(1134),Eb=b(1022),Ic=b(923),Zc=b(55),Pc=b(60);l.prototype.dispose=function(){var ka=this;P.ULS.sendTraceTag(537170064,0,50,"CalcManager.Dispose called");this.$.da.Za(268,function(bb){bb.YGd(ka.Slc);bb.MGd(ka.wlc)});this.gridView&&(this.gridView.Us(this.onContentReady),this.gridView.Ca&&this.gridView.Ca.VLf(this.arf),this.ny=null);this.Apf=this.xpf=this.UDc=null};l.prototype.aPg=function(ka,bb,Ha,Ga){Ga=void 0===
Ga?null:Ga;this.rl&&(pa.EwaSettings.isChangeGateEnabled("OfficeVSO:5470583_Calculate_Formula_Refactoring")?this.rl.YOg(ka,bb,Ha,Ga):this.rl.$Og(ka,bb,Ha,Ga))};l.prototype.evalFormula=function(ka){return this.rl?this.rl.evalFormula(ka):Promise.reject("calc engine not initialized")};l.prototype.evalFormulaRange=function(ka,bb,Ha){return this.rl?this.rl.evalFormulaRange(ka,bb,Ha):Promise.reject("calc engine not initialized")};l.prototype.Xrb=function(ka,bb,Ha,Ga){return this.rl?this.rl.Xrb(ka,bb,Ha,
Ga):Promise.reject("CalcEngine is null")};l.prototype.Sub=function(ka){return this.rl?(P.ULS.shipAssertTag(537170059,0,2===ka.type,"CalcManager.GetTableHeaders() - ActiveItem is not a table"),this.rl.Sub(ka)):null};l.prototype.mEg=function(ka,bb){if(!bb||2!==ka.type)return!1;ka=Da.a(ka);return ka.right-ka.left+1===bb.count};l.prototype.XOe=function(ka){if(!this.SDb)return this.Xbg||P.ULS.sendTraceTag(537170057,0,15,"CalcManager.ExtractReferenceWrappers - parser not initialized"),null;var bb=this.rsa(Ja.Range.ld(1,
1));bb=this.SDb.parseFormula(excelOnlineCalc.parse.parseLocals(1,bb.range),ka);if(!excelOnlineCalc.parse.parseResultHelper.isSuccess(bb))return P.ULS.sendTraceTag(537170056,0,10,"CalcManager.ExtractReferenceWrappers - ParseFormula failed"),null;try{if(pa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.StructuredReferencesHighlighting",!1)){var Ha=this.gridView.ha.va.activeCell,Ga=excelOnlineCalc.location.gridCell(Ha.top-1,Ha.left-1),Ua=excelOnlineCalc.location.documentLoc("",this.$.workbookContext.FullDocumentInfo.BreadcrumbDocName),
jb=excelOnlineCalc.location.sheetIndex(Ua,this.$.xa.oa.sheetId),$a=this.J4g(Ga,jb);this.PId||(this.PId=excelOnlineCalc.util.createResolver(this.I4g()));var Yb=excelOnlineCalc.parse.parseResultHelper.extractReferences(bb,this.Br.config.localeInfo,pa.EwaSettings.la(622),$a,this.PId)}else Yb=excelOnlineCalc.parse.parseResultHelper.extractReferences(bb,this.Br.config.localeInfo,pa.EwaSettings.la(622));pa.EwaSettings.la(102)&&this.NKj(Yb,ka);return Yb}catch(ec){return P.ULS.sendTraceTag(537170055,0,10,
"CalcManager.ExtractReferenceWrappers - exception: {0}",ec.message),null}};l.prototype.extractLetVariables=function(ka,bb){if(!this.SDb)return this.Xbg||P.ULS.sendTraceTag(537170054,0,15,"CalcManager.ExtractLetVariables - parser not initialized"),null;var Ha=this.rsa(Ja.Range.ld(1,1));ka=this.SDb.parseFormula(excelOnlineCalc.parse.parseLocals(1,Ha.range),ka);if(!excelOnlineCalc.parse.parseResultHelper.isSuccess(ka))return P.ULS.sendTraceTag(537170053,0,10,"CalcManager.ExtractLetVariables - ParseFormula failed"),
null;try{return excelOnlineCalc.parse.parseResultHelper.extractLetVariables(ka,bb,this.Br.config.localeInfo)}catch(Ga){return P.ULS.sendTraceTag(537170052,0,10,"CalcManager.ExtractLetVariables - exception: {0}",Ga.message),null}};l.prototype.extractReferences=function(ka,bb,Ha,Ga){if(!bb)return P.ULS.sendTraceTag(537170051,0,10,"CalcManager.ExtractReferences - sheetName is null"),null;if(!Ha)return P.ULS.sendTraceTag(537170050,0,10,"CalcManager.ExtractReferences - documentName is null"),null;var Ua=
this.XOe(ka);if(!Ua)return P.ULS.sendTraceTag(537170049,0,15,"CalcManager.ExtractReferences - ExtractReferenceWrappers returned null"),null;try{return this.L3g(Ua,bb,Ha,ka,Ga)}catch(jb){return P.ULS.sendTraceTag(537170048,0,10,"CalcManager.ExtractReferences - exception: {0}",jb.message),null}};l.prototype.lSh=function(ka,bb,Ha,Ga){if(!ka)return P.ULS.sendTraceTag(537170019,0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - range is null"),null;if(!bb||0>=bb.length)return P.ULS.sendTraceTag(537170018,
0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - formula is null/empty"),null;ka=this.rsa(ka);if(!this.Br||!ka)return null;var Ua=this.Btb(ka).returnValue;if(!Ua||Ua.V4a)return null;Ha=excelOnline.utils.getCharIndexInTextFromPoint(Ha,Ga,pa.EwaSettings.la(622));return 0>Ha?null:excelOnlineCalc.runtime.getSubExpressionFromFormulaCharacterIndex(this.Br.config,Ha,bb,ka)};l.prototype.QOg=function(ka,bb,Ha,Ga){var Ua=this;if(!ka)return P.ULS.sendTraceTag(537170017,0,10,"CalcManager.CalcPartialResultsForFormula - range is null"),
null;var jb=null;return this.evalFormula(bb).then(function($a){var Yb=Ua.Br.Rhh($a,Ha),ec=Yb.returnValue;8!==Yb.kind||ec.length&&ec!==wa.CalcHelper.unknownError?$a=0:(P.ULS.sendTraceTag(537170016,0,50,"EvalSession.GetPartialResultValueForFormula - EvalResultToString error"),$a=excelOnlineCalc.calc.getEvalFailureReason($a),void 0!==$a&&null!==$a||P.ULS.shipAssertTag(537170015,0,!1,"CalcHelper.GetEvalFailureReason() - result is not a failure, function should not be called"),$a=1);return jb=Ga?new Lb.a(ec,
Ga.start,Ga.end,$a):new Lb.a(ec,-1,-1,$a)},function($a){P.ULS.sendTraceTag(537170014,0,10,"EvalSession.GetPartialResultValueForFormula - exception: {0}",$a);return Promise.resolve(jb)})};l.prototype.getSubExpressionSpan=function(ka){return this.Br&&ka?excelOnlineCalc.runtime.getSubExpressionSpan(ka):null};l.prototype.getFormulaSubExpressionObject=function(ka,bb,Ha){return this.Br&&ka&&bb&&Ha?excelOnlineCalc.runtime.getFormulaSubExpressionObject(this.Br.config,bb,Ha,this.rsa(ka)):null};l.prototype.oSh=
function(ka,bb,Ha){return this.Br&&ka&&bb?excelOnlineCalc.runtime.getSubstitutedSubExpressionString(this.Br.config,bb,Ha,this.rsa(ka)):null};l.prototype.mSh=function(ka,bb,Ha){return this.Br&&ka&&bb?excelOnlineCalc.runtime.getSubExpressionSubspans(this.Br.config.localeInfo,bb,Ha):null};l.prototype.OLh=function(){return this.Br?this.Br.config.localeInfo.listSeparator:null};l.prototype.isFormulaSubExpressionVolatile=function(ka){return this.Br?excelOnlineCalc.runtime.isFormulaSubExpressionVolatile(this.Br.config.localeInfo,
ka):!1};l.prototype.rsa=function(ka){return ka&&this.Br?this.Br.g5g(this.Br.V6g(),ka.top-1,ka.left-1):null};l.prototype.Uai=function(ka,bb){ka=this.Ndd(ka);if(void 0===ka||null===ka)return null;ka=this.Np.createFormat(ka.FormatString,ka.Builtin);if(!excelOnlineCalc.util.isSuccess(ka))return null;bb=this.Np.parseEdit(bb,ka.value);return excelOnlineCalc.util.isSuccess(bb)?bb.value.kind===Eb.a.formula:null};l.prototype.Mdd=function(ka){if(!ka.isValid())return P.ULS.sendTraceTag(537170013,0,50,"CalcManager.GetNumberFormat: invalid format was given! ifmt: {0}, format string: {1}, format obj: {2}",
null!=ka.mE?ka.mE.toString():"null",ka.formatString?Ma.a.dJ(ka.formatString):"null",ka.numberFormat?"!null":"null"),null;var bb=ka.BKh();if("String"===Object.getType(bb).getName())var Ha=this.Apf;else if("Number"===Object.getType(bb).getName())Ha=this.xpf;else return P.ULS.sendTraceTag(537170012,0,10,"CalcManager.GetNumberFormat: key is of unknown type!"),null;bb=bb.toString();if(bb in Ha)return Ha[bb].numberFormat;Ha[bb]=ka;return ka.numberFormat};l.prototype.getWorksheetFuncId=function(ka){return this.localeInfo.getWorksheetFuncId(ka)};
l.prototype.L3g=function(ka,bb,Ha,Ga,Ua){for(var jb={Items:[]},$a=0;$a<ka.length;$a++){var Yb=ka[$a],ec={};ec.Start=Yb.span.start;ec.End=Yb.span.end;if(Ua||Yb.kind!==wb.a.func)if(Ua||Yb.kind!==wb.a.Oki){if(this.Mch(Yb,bb,Ha)){var Za=new v,Wa=this.rPh(Yb,bb,Za,Ga);if(pa.EwaSettings.la(622)){var Ca=this.ELh(Yb),db=this.DLh(Yb);if(Wa||db&&0<=Ca)ec={Span:ec,LetNumber:Ca,LetName:db,Range:Wa},ec.IsRangeRef=Za.G5a,ec.IsAbsoluteFirstRow=Za.Mva,ec.IsAbsoluteFirstColumn=Za.Lva,ec.IsAbsoluteSecondRow=Za.ZKa,
ec.IsAbsoluteSecondColumn=Za.YKa,ec.IsStructRef=Yb.kind===wb.a.pRd,Array.add(jb.Items,ec)}else Wa&&(ec={Span:ec,Range:Wa},ec.IsRangeRef=Za.G5a,ec.IsAbsoluteFirstRow=Za.Mva,ec.IsAbsoluteFirstColumn=Za.Lva,ec.IsAbsoluteSecondRow=Za.ZKa,ec.IsAbsoluteSecondColumn=Za.YKa,ec.IsStructRef=Yb.kind===wb.a.pRd,Array.add(jb.Items,ec))}}else Yb=Yb.ref.value.oper.kind,Array.add(jb.Items,{Span:ec,IsString:2===Yb,IsBoolean:4===Yb,IsNumber:1===Yb});else ec.End=Yb.span.start+Yb.ref.name.length,Array.add(jb.Items,{Span:ec,
IsFunction:!0})}jb.Items.sort(function($b,Jb){return $b.Span.Start-Jb.Span.Start});return jb};l.prototype.ELh=function(ka){return ka.kind===wb.a.jhf?ka.ref.number:-1};l.prototype.DLh=function(ka){return ka.kind===wb.a.jhf?ka.ref.name:null};l.prototype.rPh=function(ka,bb,Ha,Ga){if(ka.kind===wb.a.range)return Ha.G5a=!0,this.vze(ka,bb,Ha,Ga);if(ka.kind===wb.a.namedRange){Ha=ka.ref;(ka=this.$.xb.getItemByName(Ha.name))||(ka=this.$.xb.getItemByName(bb+"!"+Ha.name));if(!(ka&&ka.sheetName&&ka.usedRange&&
Ma.a.equals(ka.sheetName,bb,!0)))return null;bb=2===ka.type?Da.a(ka):ka.usedRange;return sb.m(bb,ka)}if(ka.kind===wb.a.pRd){var Ua=ka.ref,jb;Ua.name?(jb=this.$.xb.getItemByName(Ua.name))||(jb=this.$.xb.getItemByName(bb+"!"+Ua.name)):jb=this.gridView.Vb.vk(this.gridView.ha.va.activeCell);if(!(jb&&jb.sheetName&&jb.usedRange&&Ma.a.equals(jb.sheetName,bb,!0)))return null;Ha.G5a=!1;return this.vze(ka,bb,Ha,Ga)}return null};l.prototype.vze=function(ka,bb,Ha,Ga){ka=ka.ref;if(ka.type){if(ka.type===Mb.a.column){var Ua=
ka.startIndex;ka=ka.endIndex;Ha.Lva=Ua.kind===Ic.a.abs;Ha.YKa=ka.kind===Ic.a.abs;return this.createRange(0,Ua.index,Q.a.Fh,ka.index,bb)}if(ka.type===Mb.a.row)return Ua=ka.endIndex,Ha.Mva=ka.startIndex.kind===Ic.a.abs,Ha.ZKa=Ua.kind===Ic.a.abs,this.createRange(ka.startIndex.index,0,ka.endIndex.index,Q.a.Qh,bb);if(ka.type===Mb.a.cell){Ua=ka.row;var jb=ka.col;Ha.Mva=Ha.ZKa=Ua.kind===Ic.a.abs;Ha.Lva=Ha.YKa=jb.kind===Ic.a.abs;return this.l0b(ka.span.end,Ga)&&(Ha=Ja.Range.ld(Ua.index+1,jb.index+1),Ha=this.gridView.Vb.U_e(Ha))?
sb.n(Ha,bb):this.createRange(Ua.index,jb.index,Ua.index,jb.index,bb)}if(ka.type===Mb.a.range){Ua=ka.top;jb=ka.left;Ga=ka.bottom;ka=ka.right;var $a=Math.min(Ua.index,Ga.index),Yb=Math.min(jb.index,ka.index),ec=Math.max(Ua.index,Ga.index),Za=Math.max(jb.index,ka.index);Ha.Mva=Ua.kind===Ic.a.abs;Ha.ZKa=Ga.kind===Ic.a.abs;Ha.Lva=jb.kind===Ic.a.abs;Ha.YKa=ka.kind===Ic.a.abs;return this.createRange($a,Yb,ec,Za,bb)}P.ULS.sendTraceTag(537170010,0,10,"CalcManager.CovertFormulaRefToRange: Unsupported formula ref type '{0}'",
ka.type);return null}P.ULS.sendTraceTag(537170011,0,15,"CalcManager.CovertFormulaRefToRange: traverseFormulaRef.Type is null");return null};l.prototype.l0b=function(ka,bb){return bb.length>=ka&&0<ka&&bb.charAt(ka-1)===u.oEf};l.prototype.VOg=function(ka,bb,Ha){this.rl&&this.rl.ZOg(ka,bb,Ha)};l.prototype.Ndd=function(ka){return this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.Jba&&this.instantaneousSupportInformationManager.Jba[ka]&&this.Np?this.instantaneousSupportInformationManager.Jba[ka]:
null};l.prototype.toXLNumber=function(ka){if(!this.Np)return null;ka=excelOnlineCalc.numfmt.toXLNumber(this.config.mathpack,this.Np,ka);return excelOnlineCalc.util.isSuccess(ka)?ka.value:null};l.prototype.NKj=function(ka,bb){if(ka){ka=yl(ka);for(var Ha=ka.next();!Ha.done;Ha=ka.next())if(Ha=Ha.value,Ha.ref.type&&Ha.ref.type===Mb.a.cell){var Ga=Ha.ref;l.DSi(Ga,bb)&&(Ga.span.end+=1,Ha.span.end+=1)}}};l.prototype.createRange=function(ka,bb,Ha,Ga,Ua){var jb={};jb.FirstRow=ka;jb.FirstColumn=bb;jb.LastRow=
Ha;jb.LastColumn=Ga;jb.SheetName=Ua;return jb};l.prototype.Mch=function(ka,bb,Ha){var Ga=ka.ref.qualifier;if(!Ga)return!0;switch(ka.ref.qualifier.type){case f.sheet:return ka=Ga.document,Ma.a.equals(Ga.sheet,bb,!0)&&(!ka||Ma.a.equals(ka.document,Ha,!0));case f.sheetRange:return bb=this.$.xa.getItemByName(bb),Ha=this.$.xa.getItemByName(Ga.sheet1),Ga=this.$.xa.getItemByName(Ga.sheet2),!!bb&&!!Ha&&!!Ga&&(Ha.index<=bb.index&&bb.index<=Ga.index||Ga.index<=bb.index&&bb.index<=Ha.index);case f.document:return Ma.a.equals(Ga.document,
Ha,!0);case f.r1h:return Ga=Ga.name,Ma.a.equals(Ga,bb,!0)||Ma.a.equals(Ga,Ha,!0);default:return P.ULS.sendTraceTag(537170009,0,10,"CalcManager.GetQualifierData: Unsupported formula qualifier type '{0}'",Ga.type),!1}};l.prototype.wFj=function(ka){this.instantaneousSupportInformationManager=ka;ka.Jba.length&&ka.Jia.length?(this.UDc=new wa.CalcHelper(this.gridView.$),this.SDb=this.Br.createParser(),this.w$d=this.Br.createNumberFormatter(),this.S9e=!0,P.ULS.sendTraceTag(537170007,0,50,"CalcManager.TryInitializeInternal: calc initialized"),
this.rl||(P.ULS.sendTraceTag(537170006,0,50,"CalcManager creating calc engine"),this.rl=new m(this.$))):P.ULS.sendTraceTag(537170008,0,15,"CalcManager.TryInitializeInternal: IInstantaneousSupportInformationManager locale information missing, cannot initialize calc. number formats count = {0}, functions info count = {1}",ka.Jba.length,ka.Jia.length.toString())};l.prototype.Btb=function(ka){if(!ka)return{returnValue:null,emptyCell:!1};var bb=this.getSheetName(ka.sheet.index);if(!bb)return P.ULS.sendTraceTag(537169998,
0,50,"CalcManager.GetCellFromBlockCache: No sheet index {0}",ka.sheet.index),{returnValue:null,emptyCell:!1};var Ha=l.convertToRange(ka);bb=this.gridView.Btb(bb,Ha.top,Ha.left);return bb?bb.Hch?{returnValue:bb,emptyCell:!1}:(P.ULS.sendTraceTag(537169996,0,50,"CalcManager.GetCellFromBlockCache: cell {0} {1} is empty",ka.range.row,ka.range.col),{returnValue:null,emptyCell:!0}):(P.ULS.sendTraceTag(537169997,0,50,"CalcManager.GetCellFromBlockCache: cellProxy is null for cell {0} {1}",ka.range.row,ka.range.col),
{returnValue:null,emptyCell:!1})};l.prototype.getSheetName=function(ka){var bb=this.gridView.$.xa.getItem(ka);return bb?bb.sheetName:(P.ULS.sendTraceTag(537169995,0,50,"CalcManager.GetSheetName - no sheet in index {0}",ka),null)};l.prototype.J4g=function(ka,bb){var Ha={allowUnqualifiedCell:!0,wrapCellReferences:!0};Ha.config=this.Br.config;Ha.originGridCell=excelOnlineCalc.util.success(ka);Ha.originSheet=excelOnlineCalc.util.success(bb);return Ha};l.prototype.I4g=function(){var ka={};ka.config=this.Br.config;
ka.getNameLoc=Object(za.a)(this.rl,this.rl.getNameLoc,"getNameLoc");ka.getContainingTable=Object(za.a)(this.rl,this.rl.getContainingTable,"getContainingTable");ka.getStructRefColumn=Object(za.a)(this.rl,this.rl.getStructRefColumn,"getStructRefColumn");ka.getStructRefSpecialRef=Object(za.a)(this.rl,this.rl.getStructRefSpecialRef,"getStructRefSpecialRef");ka.getDocumentLoc=Object(za.a)(this.rl,this.rl.getDocumentLoc,"getDocumentLoc");ka.getSheetIndex=Object(za.a)(this.rl,this.rl.getSheetIndex,"getSheetIndex");
ka.getSheetName=Object(za.a)(this.rl,this.rl.getSheetName,"getSheetName");ka.getUserDefinedFuncLoc=Object(za.a)(this.rl,this.rl.getUserDefinedFuncLoc,"getUserDefinedFuncLoc");ka.getSheetRangeIndexes=Object(za.a)(this.rl,this.rl.getSheetRangeIndexes,"getSheetRangeIndexes");return ka};l.DSi=function(ka,bb){return bb.length>ka.span.end&&bb.charAt(ka.span.end)===u.oEf};l.convertToRange=function(ka){return Ja.Range.ld(ka.range.row+1,ka.range.col+1)};tl.Object.defineProperties(l.prototype,{Br:{configurable:!0,
enumerable:!0,get:function(){return this.UDc}},gridView:{configurable:!0,enumerable:!0,get:function(){return this.ny}},$:{configurable:!0,enumerable:!0,get:function(){return this.vb}},Np:{configurable:!0,enumerable:!0,get:function(){return this.w$d}},localeInfo:{configurable:!0,enumerable:!0,get:function(){return this.Br?this.Br.config.localeInfo:null}},config:{configurable:!0,enumerable:!0,get:function(){return this.Br.config}}});Object(D.a)(l,"CalcManager",null,[428,3]);var vd=b(35),Tc=b(51),rb=
ia.a;vm(n,rb);n.prototype.create=function(){var ka=this;if(this.$){P.ULS.sendTraceTag(537169993,0,50,"CalcManagerFactory.Create: Start loading script");if(pa.EwaSettings.isChangeGateEnabled("OfficeVSO:5543503_loadCalcCurrentVersion")){var bb=53;var Ha="Current"}else bb=56,Ha="Stable";P.ULS.sendTraceTag(537169992,0,50,"CalcManagerFactory.Create: Calc {0} JS was loaded",Ha);vd.TaskExtensions.Ba(Tc.a.loadScript(bb,4,this.tb,void 0,void 0,265),function(){P.ULS.sendTraceTag(537169991,0,50,"CalcManagerFactory.Create: Raised create service event");
var Ga=ka.$.da.Aa(266,!1);Ga||(P.ULS.sendTraceTag(537169990,0,50,"CalcManagerFactory.Create: CalcManager is not registered, creating new CalcManager"),Ga=new l(ka.$));ka.Fb(Ga)},this.ma,3)}else P.ULS.sendTraceTag(537169994,0,50,"CalcManagerFactory.Create: ewaControl is null, cann't create the service")};n.ja=function(ka){ka&&ka.da&&ka.da.Ha(265,new n(ka))};Object(D.a)(n,"CalcManagerFactory",ia.a,[]);var eb=b(4),Ta=b(318);Object(D.a)(k,"MarqueeMetadata",null,[]);var fb=b(129),pb=b(647),rc=b(336);c.prototype.WW=
function(ka,bb){this.nci&&ka.textBox.addEventLogRecord("ColoredReferencesManager.TryUpdateColoredReferences");if(this.O3f||ka.DM)return!1;var Ha=void 0===bb||null===bb?ka.text:bb;if(this.calcManager&&1<Ha.length&&Ya.e(Ha)){var Ga=this.aed(),Ua=this.ZYe(),jb=this.Nc.workbookContext.WorkbookFileName,$a=!1,Yb=.01>Math.random()?Object(Gb.a)(fb.a,this.Nc.Ub.Fc("LoadingUIShown","ColoredReferencesManager")):null;try{var ec=this.calcManager.extractReferences(Ha,Ua,jb,!this.y9e);if(!ec)return P.ULS.sendTraceTag(537169989,
0,50,"ColoredReferencesManager.UpdateColoredReferences: extractReferences is null (might be an invalid formula)"),!1;Ua=[];jb=[];for(var Za=[],Wa=[],Ca=0,db=0,$b=new xa.a(!1),Jb="",Hc=yl(ec.Items),uc=Hc.next();!uc.done;uc=Hc.next()){var Aa=uc.value;$a=Aa.IsStructRef||$a;if(Aa.IsBoolean||Aa.IsNumber||Aa.IsString){var mb=Aa.IsBoolean?c.mKg:Aa.IsNumber?c.kxi:c.vyj;this.ZEa(jb,Ha,Ca,Aa.Span.Start,null);this.ZEa(jb,Ha,Aa.Span.Start,Aa.Span.End,mb);Ca=Aa.Span.End}else if(pa.EwaSettings.la(622)){if(Aa.Range||
Aa.LetName&&0<=Aa.LetNumber){ec=null;if(Aa.Range){var dc=sb.D(Aa.Range);ec=this.Htb(dc,$b,1);Array.add(Ua,new rc.a(dc,Ga))}else Aa.LetName&&0<=Aa.LetNumber&&(ec=Jb=this.iFh(Aa.LetName,Aa.LetNumber,$b,Jb),db!==$b.count&&ka.colors.add(Aa.Span.Start+"-"+Aa.Span.End,this.colors[($b.count-1)%this.colors.length]));this.ZEa(jb,Ha,Ca,Aa.Span.Start,null);this.ZEa(jb,Ha,Aa.Span.Start,Aa.Span.End,ec);Ca=Aa.Span.End;Array.add(Za,Aa.Span);var Ac=jb.length-1;Array.add(Wa,new k(Ac,jb[Ac].text,Aa));db=$b.count}}else if(Aa.Range){var bd=
sb.D(Aa.Range),Kd=this.Htb(bd,$b,1);this.ZEa(jb,Ha,Ca,Aa.Span.Start,null);this.ZEa(jb,Ha,Aa.Span.Start,Aa.Span.End,Kd);Array.add(Ua,new rc.a(bd,Ga));Ca=Aa.Span.End;Array.add(Za,Aa.Span);var Yd=jb.length-1;Array.add(Wa,new k(Yd,jb[Yd].text,Aa))}}this.ZEa(jb,Ha,Ca,Ha.length,null);this.Plj(ka,jb,!!bb);var qd=ka.textBox.text;if(!Ma.a.equals(qd,Ha,!1)){P.ULS.shipAssertTag(38114182,0,!1,"ColoredReferencesManager.UpdateColoredReferences: The text we created is different from the original text. Setting the original text back. currentTextLength [{0}], originalTextLength [{1}]",
qd.length,Ha.length);var Ie=ka.textBox.caretPosition;ka.textBox.text=Ha;ka.textBox.caretPosition=Ie;return!0}this.xcc(Ua,$b,Wa);pa.EwaSettings.la(622)&&0<Ua.length&&P.ULS.sendTraceTag(537169988,0,50,"ColoredReferencesManager.UpdateColoredReferences: Cell reference(s) colored");pa.EwaSettings.la(622)&&0<ka.colors.count&&P.ULS.sendTraceTag(537169987,0,50,"ColoredReferencesManager.UpdateColoredReferences: Let name(s) colored");return this.q4a=!0}finally{Yb&&Yb.mAa(function(){$a&&P.ULS.sendTraceTag(537169986,
0,50,"ColoredReferencesManager.UpdateColoredReferences: Formula with structured reference is highlighted in {0} ms",Yb.Ac)})}}else return this.xcc(null,null),this.q4a&&(this.q4a=!1,Ga=ka.textBox.caretPosition,ka.textBox.setPlainText(Ha),ka.textBox.caretPosition=Math.min(Ga,Ha.length),bb)?!0:!1};c.prototype.enf=function(ka,bb,Ha){if(!ka||!bb||!Ha)return P.ULS.shipAssertTag(537169985,0,!!ka,"ColoredReferencesManager.MoveMarqueeRange: cellContentEditor is null"),P.ULS.shipAssertTag(537169984,0,!!bb,
"ColoredReferencesManager.MoveMarqueeRange: highlightState is null"),P.ULS.shipAssertTag(537169955,0,!!Ha,"ColoredReferencesManager.MoveMarqueeRange: newRange is null"),!1;var Ga=Object(Gb.a)(k,bb.metadata);if(!Ga)return P.ULS.shipAssertTag(537169954,0,!1,"ColoredReferencesManager.MoveMarqueeRange: marqueeMetadata is null"),!1;var Ua=Ga.bBj,jb=Ga.T4f,$a=this.gridView.Vb.Q$e(Ha)?Ha.o$b(Ga.Lva,Ga.Mva):Ha.a3a(Ga.Lva,Ga.Mva,Ga.YKa,Ga.ZKa);if(!$a)return P.ULS.shipAssertTag(537169953,0,!1,"ColoredReferencesManager.MoveMarqueeRange: newText is null"),
!1;var Yb=jb.indexOf("!");-1!==Yb&&($a=jb.substring(0,Yb+1)+$a);if(!ka.textBox.changeTextInExistingTextPart(Ua,jb,$a))return P.ULS.shipAssertTag(38926105,0,!1,"ColoredReferencesManager.MoveMarqueeRange: failed to change the text part"),!1;Ga.T4f=$a;Ua=!0;for(jb=1;4>=jb;jb++)($a=zb.g(this.Nc).Nb.OG(3,jb,bb.W9))?($a.range=Ha,$a.metadata=Ga):(P.ULS.shipAssertTag(537169952,0,!1,"ColoredReferencesManager.MoveMarqueeRange: highlightStateInPane is null"),Ua=!1);this.gridView.Nb.update(!1,!1);this.gridView.rc.xj&&
(this.gridView.rc.textBox.text=ka.text);this.gridView.rc.YEb(new Ta.a(!0));return Ua};c.prototype.rci=function(ka){if(3!==ka.Wq)return P.ULS.shipAssertTag(537169951,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: not HighlightDivIndex.Marquee."),!1;ka=Object(Gb.a)(k,ka.metadata);return ka?ka.G5a&&!ka.Xfc:(P.ULS.shipAssertTag(537169950,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: marqueeMetadata is null."),!1)};c.prototype.Ncb=function(ka,bb){P.ULS.sendTraceTag(537169949,0,
50,"ColoredReferencesManager.SuspendResumeColoredReferences: "+(bb?"suspending":"resuming")+" colored references");!bb||this.fef&&!this.q4a||(this.fef&&(this.q4a=!1),this.xcc(null,null),ka.textBox.JTg());this.O3f=bb};c.prototype.dispose=function(){this.gridView&&this.gridView.Kc&&this.gridView.Kc.Rp(this.PBb)};c.prototype.q0h=function(ka){var bb=this.aed(),Ha=this.ZYe(),Ga=this.Nc.workbookContext.WorkbookFileName,Ua=[],jb=new xa.a(!1),$a=[];if(Ha=this.calcManager.extractReferences(ka,Ha,Ga,!this.y9e)){Ha=
yl(Ha.Items);for(Ga=Ha.next();!Ga.done;Ga=Ha.next())if(Ga=Ga.value,Ga.Range){var Yb=sb.D(Ga.Range);Array.add(Ua,new rc.a(Yb,bb));this.Htb(Yb,jb,1);Array.add($a,new k(Ga.Span.Start,ka.substring(Ga.Span.Start,Ga.Span.End),Ga,!0))}this.xcc(Ua,jb,$a)}};c.prototype.Htb=function(ka,bb,Ha){var Ga=bb.getItem(ka.toString());Ga||(Ga=this.colors[bb.count%this.colors.length],bb.add(ka.toString(),Ga));return String.format(Ga,Ha)};c.prototype.iFh=function(ka,bb,Ha,Ga){ka="["+ka+", "+bb+"]";bb=Ha.getItem(ka);bb||
(bb=Ha.count%this.colors.length,bb=this.colors[bb],Ga===String.format(bb,1)&&(Ha.add("skip-"+ka,bb),bb=Ha.count%this.colors.length,bb=this.colors[bb]),Ha.add(ka,bb));return String.format(bb,1)};c.prototype.ZEa=function(ka,bb,Ha,Ga,Ua){P.ULS.shipAssertTag(537169948,0,Ha<=Ga,"ColoredReferencesManager.AddTextPart: startIndex cannot be larger than endIndex");Ha<Ga&&(bb=bb.substring(Ha,Ga),Array.add(ka,Object.assign(new pb.a,{text:bb,color:Ua})))};c.prototype.xcc=function(ka,bb,Ha){var Ga=this;Ha=void 0===
Ha?null:Ha;ka&&ka.length?(P.ULS.sendTraceTag(537169947,0,50,"ColoredReferencesManager.HighlightRanges: number of ranges to highlight: "+ka.length),ka.reverse(),Ha.reverse(),this.gridView.Nb.uw(ka,[3],!0,function(Ua,jb){if(Ua&&Ua.range&&jb){P.ULS.shipAssertTag(537169943,0,bb.wb(Ua.range.toString()),"ColoredReferencesManager.HighlightRanges: The range '{0}' doesn't exist in the range to color dictionary",Ua.range.toString());var $a=Ga.Htb(Ua.range,bb,.1),Yb=Ga.Htb(Ua.range,bb,1);Ga.Nc.frame&&Ga.Nc.frame.XG&&
Ga.Nc.frame.XG.eka||(jb.style.background=$a);jb.style.borderColor=Yb;Ha&&(jb.setAttribute(eb.a.xwb,Ua.W9.toString()),Ua.metadata=Ha[Ua.W9])}else P.ULS.shipAssertTag(537169946,0,!!Ua,"ColoredReferencesManager.HighlightRanges: state is null"),P.ULS.shipAssertTag(537169945,0,!!Ua.range,"ColoredReferencesManager.HighlightRanges: state.Range is null"),P.ULS.shipAssertTag(537169944,0,!!jb,"ColoredReferencesManager.HighlightRanges: div is null")})):(ka=this.Nc.Ub.Fc("UserAction","HideRangesHighlightsStopwatch"),
this.gridView.Nb.kl([3]),this.gridView.Nb.DIb(new rc.a(null,this.aed()),[3]),ka.stop())};c.prototype.Plj=function(ka,bb,Ha){var Ga=ka.textBox;Ga.QJ=!0;var Ua=Ga.selection,jb=Ua.index;Ua=jb+Ua.length;Ga.setTextFromTextParts(bb);bb=Ga.text.length;Ga.selectRange(Math.min(jb,bb),Math.min(Ua,bb));Ha&&ka.YEb(new Ta.a);Ga.QJ=!1};c.prototype.aed=function(){return this.YYe().sheetId};c.prototype.ZYe=function(){return this.YYe().sheetName};c.prototype.YYe=function(){return this.gridView.Ts&&this.gridView.Ts.rK?
this.gridView.Ts.rK:this.Nc.oa};c.kxi="rgba(9, 134, 88, 1)";c.mKg="rgba(0, 0, 255, 1)";c.vyj="rgba(163, 21, 21, 1)";Object(D.a)(c,"ColoredReferencesManager",null,[435,3]);var vb=ia.a;vm(d,vb);d.prototype.create=function(){var ka=this;this.$.da.Za(266,function(bb){ka.Fb(new c(ka.$,bb))})};d.ja=function(ka){ka.da.Ha(282,new d(ka))};Object(D.a)(d,"ColoredReferencesManagerFactory",ia.a,[]);var E=b(935),Nb=ia.a;vm(a,Nb);a.prototype.create=function(){var ka=this;this.$.da.Za(266,function(bb){ka.Fb(new E.RelativeAndAbsoluteReferencesManager(bb))})};
a.ja=function(ka){ka.da.Ha(295,new a(ka))};Object(D.a)(a,"RelativeAndAbsoluteReferencesManagerFactory",ia.a,[]);Type.registerNamespace("_Ewa");y.a.Ga(w.ja);y.a.Ga(n.ja);y.a.Ga(d.ja);y.a.Ga(a.ja)},923:function(y,D,b){function a(){}b.d(D,"a",function(){return a});y=b(0);a.abs="Abs";a.rel="Rel";Object(y.a)(a,"PositionBaseType",null,[])},935:function(y,D,b){function a(B){this.calcManager=B}function d(){return v.call(this)||this}function c(){this.Ysc=this.firstRow=null;return this}function k(){return v.call(this)||
this}function n(){this.right=this.left=this.bottom=this.top=null;return this}function l(){return v.call(this)||this}function f(){this.Xsc=this.firstColumn=null;return this}function u(){var B=v.call(this)||this;B.Wfc=!1;return B}function v(){this.end=this.start=0;this.Uu=null}function m(){this.column=this.row=null;return this}function A(){}b.r(D);y=b(0);var x=b(13);Object(y.a)(A,"Reference",null,[]);vm(m,A);Object(y.a)(m,"CellReference",A,[]);v.prototype.RFg=function(B,U){for(var N=0;N<this.Uu.length;N++){var P=
this.YYb(B,this.Uu[N]);U+=P;N<this.Uu.length-1&&(U+=":")}return U};Object(y.a)(v,"IReferenceSequence",null,[]);var t=b(24),z=b(923);vm(u,v);u.prototype.hac=function(){var B=b(935).RelativeAndAbsoluteReferencesManager,U=this.Uu[0];return B.kof(U.row.kind===z.a.abs,U.column.kind===z.a.abs)};u.prototype.YYb=function(B,U){U=t.Range.ld(U.row.index+1,U.column.index+1);return this.Wfc?U.o$b(1===B||3===B,1===B||2===B):U.a3a(1===B||3===B,1===B||2===B,!0,!0)};Object(y.a)(u,"CellReferenceSequence",v,[]);vm(f,
A);Object(y.a)(f,"ColumnReference",A,[]);vm(l,v);l.prototype.hac=function(){var B=this.Uu[0];return b(935).RelativeAndAbsoluteReferencesManager.Hmf(B.firstColumn,B.Xsc).kind===z.a.abs?2:3};l.prototype.YYb=function(B,U){return t.Range.ctb(U.firstColumn.index+1,U.Xsc.index+1).a3a(1===B||3===B,!0,1===B||3===B,!0)};Object(y.a)(l,"ColumnReferenceSequence",v,[]);vm(n,A);Object(y.a)(n,"RangeReference",A,[]);vm(k,v);k.prototype.hac=function(){var B=b(935).RelativeAndAbsoluteReferencesManager,U=this.Uu[0];
return B.kof(U.top.kind===z.a.abs,U.left.kind===z.a.abs)};k.prototype.YYb=function(B,U){U=new t.Range(U.top.index+1,U.left.index+1,U.bottom.index+1,U.right.index+1,!1,!1);var N=1===B||3===B;B=1===B||2===B;return U.a3a(N,B,N,B)};Object(y.a)(k,"RangeReferenceSequence",v,[]);vm(c,A);Object(y.a)(c,"RowReference",A,[]);vm(d,v);d.prototype.hac=function(){var B=this.Uu[0];return b(935).RelativeAndAbsoluteReferencesManager.Hmf(B.firstRow,B.Ysc).kind===z.a.abs?0:1};d.prototype.YYb=function(B,U){return t.Range.X8b(U.firstRow.index+
1,U.Ysc.index+1).a3a(!0,1===B||2===B,!0,1===B||2===B)};Object(y.a)(d,"RowReferenceSequence",v,[]);var r=b(1133),G=b(1134),w=b(194);b.d(D,"RelativeAndAbsoluteReferencesManager",function(){return a});a.prototype.U_a=function(B,U,N){var P=U;var ia=N;if(!B||!w.e(B))return{returnValue:B,Evd:P,Dvd:ia};var W=this.calcManager.XOe(B);if(!W)return x.ULS.sendTraceTag(537169940,0,15,"RelativeAndAbsoluteReferencesManager.CycleThroughRelativeAndAbsoluteReferences: Couldn't extract references (might be invalid formula)"),
{returnValue:null,Evd:P,Dvd:ia};W=this.aRh(W,B,U,N);for(var R=0,I="",Q=0,O=0;O<W.length;O++)if(this.rGe(W[O],U,N)){R=W[O].hac();P=W[O].start;break}for(;O<W.length&&this.rGe(W[O],U,N);O++)I+=B.substring(Q,W[O].start),I=W[O].RFg(R,I),Q=W[O].end;Q&&(ia=I.length);I+=B.substring(Q,B.length);return{returnValue:I,Evd:P,Dvd:ia}};a.prototype.aRh=function(B,U,N,P){for(var ia=[],W=0;W<B.length;W++){var R=B[W];if(R.kind===r.a.range)if(R=R.ref,R.type===G.a.cell){var I=R;R=Object.assign(new u,{start:R.span.start,
end:R.span.end,Uu:[Object.assign(new m,{column:I.col,row:I.row})],Wfc:this.calcManager.l0b(R.span.end,U)});ia.push(R)}else if(R.type===G.a.range)this.sGe(R.topLeftSpan,N,P)&&this.sGe(R.bottomRightSpan,N,P)?(I=new n,R.top.index<=R.bottom.index?(I.top=R.top,I.bottom=R.bottom):(I.bottom=R.top,I.top=R.bottom),R.left.index<=R.right.index?(I.left=R.left,I.right=R.right):(I.right=R.left,I.left=R.right),R=Object.assign(new k,{start:R.topLeftSpan.start,end:R.bottomRightSpan.end,Uu:[I]}),ia.push(R)):(I=Object.assign(new u,
{start:R.topLeftSpan.start,end:R.topLeftSpan.end,Uu:[Object.assign(new m,{column:R.left,row:R.top})],Wfc:this.calcManager.l0b(R.topLeftSpan.end,U)}),R=Object.assign(new u,{start:R.bottomRightSpan.start,end:R.bottomRightSpan.end,Uu:[Object.assign(new m,{column:R.right,row:R.bottom})],Wfc:this.calcManager.l0b(R.topLeftSpan.end,U)}),ia.push(I),ia.push(R));else if(R.type===G.a.column){I=R;for(R=Object.assign(new l,{start:R.span.start,end:R.span.end,Uu:[Object.assign(new f,{firstColumn:I.startIndex,Xsc:I.endIndex})]});R.end<
U.length-1&&":"===U.charAt(R.end)&&W<B.length-1;)if(I=B[W+1].ref,I.type===G.a.column&&I.span.start===R.end+1){var Q=I;R.Uu.push(Object.assign(new f,{firstColumn:Q.startIndex,Xsc:Q.endIndex}));R.end=I.span.end;W++}else break;ia.push(R)}else if(R.type===G.a.row){I=R;for(R=Object.assign(new d,{start:R.span.start,end:R.span.end,Uu:[Object.assign(new c,{firstRow:I.startIndex,Ysc:I.endIndex})]});R.end<U.length-1&&":"===U.charAt(R.end)&&W<B.length-1;)if(I=B[W+1].ref,I.type===G.a.row&&I.span.start===R.end+
1)Q=I,R.Uu.push(Object.assign(new c,{firstRow:Q.startIndex,Ysc:Q.endIndex})),R.end=I.span.end,W++;else break;ia.push(R)}}return ia};a.prototype.rGe=function(B,U,N){return!(B.start>N||U>B.end)};a.prototype.sGe=function(B,U,N){return!(B.start>N||U>B.end)};a.Hmf=function(B,U){return B.index<=U.index?B:U};a.kof=function(B,U){return U||B?U&&B?2:!U&&B?3:0:1};Object(y.a)(a,"RelativeAndAbsoluteReferencesManager",null,[436])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDS.calc.js.map/556d52ee3d769202935cb0feb8ccc3dd/EwaDS.calc.js.map